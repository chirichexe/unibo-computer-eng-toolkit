IPTABLES 

#REGOLA 1
#CLIENT
# Rendiamo possibile l'invio dei pacchetti tcp verso port 443
iptables -I OUTPUT -o eth1 -p tcp --dport 443 -j ACCEPT

#R1
# Rendiamo possibile l'inoltro dei pacchetti tcp dall rete dei client verso i server destinati a porta 443
iptables -I FORWARD -p tcp -i eth1 -o eth2 --dport 443 -j ACCEPT  
# Cambiamo l'indirizo sorgernte cos√¨ da nascondere gli indirizzi dei client a R2 e servers sostituendolo con quello di R1 visibile su eth2
iptables -t nat -I POSTROUTING -o eth2 -p tcp --dport 443 -j SNAT --to-source 10.5.5.1

#R2
# Rendiamo possibile l'inoltro dei pacchetti tcp da R1 verso i server destinati a porta 443
iptables -I FORWARD -p tcp -i eth2 -o eth1 -s 10.5.5.1 --dport 443 -j ACCEPT


#SERVER
# Rendiamo possibile la ricezione dei pacchetti tcp a port 443
iptables -I INPUT -i eth1 -s 10.5.5.1 -p tcp --dport 443 -j ACCEPT

#REGOLA2
#R1
# Rendiamo possibile al server specificato di accedere via ssh a R1
iptables -I INPUT -p tcp -s 192.168.99.2 --dport 22 -j ACCEPT
iptables -I OUPUT -p tcp -d 192.168.99.2 --sport 22 -m state --state ESTABLISHED -j ACCEPT

#R2
# Rendiamo possibile al server specificato di accedere via ssh a R2
iptables -I INPUT -p tcp -s 192.168.99.2 --dport 22 -j ACCEPT
iptables -I OUPUT -p tcp -d 192.168.99.2 --sport 22 -m state --state ESTABLISHED -j ACCEPT
# Rednaimo possibile al server specificato di accedere via ssh a R1
iptables -I FORWARD -p tcp -s 192.168.99.2 -d 10.5.5.1 --dport 22 -j ACCEPT
iptables -I FORWARD -p tcp -s 10.5.5.1 -d 192.168.99.2 --sport 22 -m state --state ESTABLISHED -j ACCEPT

#REGOLA 3


