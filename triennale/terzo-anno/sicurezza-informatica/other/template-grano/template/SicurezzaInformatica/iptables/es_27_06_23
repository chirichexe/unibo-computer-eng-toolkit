
1. i Client devono poter accedere via HTTPS (porta TCP 443) a qualunque server; il reale indirizzo dei
client deve essere nascosto sia a R2 che ai server
2. il Server 192.168.99.2 deve poter accedere via SSH (porta TCP 22) ai due Router
3. il Client 172.16.0.2 deve poter accedere via SSH al server 192.168.99.2 utilizzando R1 e R2 come
"Jump Host" nel modello SSH Tunneling

192.168.99.0/24 --> ip server
172.16.0.0/16 --> ip client
10.5.5.1 --> ip R1
10.5.5.2 --> ip R2
-------------------------------CLIENT--------------------------------
#ripulisco le catene
iptables -F

#accedere via https ad qualunque server
iptables -A OUTPUT -d 192.168.99.0/24 -o eth1 -p tcp --dport 443 -j ACCEPT
iptables -A INPUT -s 192.168.99.0/24 -i eth1 -p tcp --sport 443 -m state --state ESTABLISHED -j ACCEPT


--------------------------------R1------------------------------------
#ripulisco le catene
iptables -F

iptables -A FORWARD -s 172.16.0.0/16 -d 192.168.99.0/24 -i eth1 -o eth2 -p tcp --dport 443 -j ACCEPT
iptables -A FORWARD -d 172.16.0.0/16 -s 192.168.99.0/24 -i eth2 -o eth1 -p tcp --sport 443 -m state --state ESTABLISHED -j ACCEPT

#nascondo l'indirizzo del client a R2 e al server
iptables -t nat -I POSTROUTING -s 172.16.0.0/16  -d 192.168.99.0/24  -p tcp --dport 443 -j SNAT --to-source 10.5.5.1
#o cos√¨?
iptables -t nat -I POSTROUTING -o eth2 -p tcp --dport 443 -j SNAT --to-source 10.5.5.1

#il server deve poter accedere via ssh ai due router
iptables -I INPUT -p tcp -s 192.168.99.2 --dport 22 -j ACCEPT
iptables -I OUPUT -p tcp -d 192.168.99.2 --sport 22 -m state --state ESTABLISHED -j ACCEPT

--------------------------------R2------------------------------------
#ripulisco le catene
iptables -F

iptables -A FORWARD -s 10.5.5.1 -d 192.168.99.0/24 -i eth2 -o eth1 -p tcp --dport 443 -j ACCEPT
iptables -A FORWARD -d 10.5.5.1 -s 192.168.99.0/24 -i eth1 -o eth2 -p tcp --sport 443 -m state --state ESTABLISHED -j ACCEPT

#il server deve poter accedere via ssh ai due router
iptables -I INPUT -p tcp -s 192.168.99.2 --dport 22 -j ACCEPT
iptables -I OUPUT -p tcp -d 192.168.99.2 --sport 22 -m state --state ESTABLISHED -j ACCEPT

--------------------------------SERVER------------------------------------
#ripulisco le catene
iptables -F

iptables -A OUTPUT -d 10.5.5.1 -o eth1 -p tcp --dport 443 -m state --state ESTABLISHED -j ACCEPT
iptables -A INPUT -s 10.5.5.1 -i eth1 -p tcp --sport 443 -j ACCEPT

#2. il Server 192.168.99.2 deve poter accedere via SSH (porta TCP 22) ai due Router
iptables -A OUTPUT -d 10.5.5.2 -o eth1 -p tcp --dport 22 -j ACCEPT
#???
iptables -I FORWARD -p tcp -s 192.168.99.2 -d 10.5.5.1 --dport 22 -j ACCEPT
iptables -I FORWARD -p tcp -s 10.5.5.1 -d 192.168.99.2 --sport 22 -m state --state ESTABLISHED -j ACCEPT