
SURICATA -------------------------------------------

Per utilizzare Suricata per analizzare un file PCAP (dump.pcap.gz) e scrivere regole personalizzate, puoi seguire questi passaggi:

=>1: Installare Suricata
sudo apt-get update
sudo apt-get install suricata

=>2: Preparare le Regole
Crea un file di regole personalizzate. Puoi chiamarlo `local.rules` e salvarlo in una directory che Suricata può accedere.

nano /etc/suricata/rules/local.rules

Aggiungi le tue regole al file:

alert tcp 172.21.1.118 any -> 172.22.2.159 80 (msg:"Attacco";content:"/api/index.html";sid:10000001;rev:1;)
alert tcp 172.22.2.159 any -> 172.21.1.118 80 (msg:"Risposta";content:"401";sid:10000002;rev:1;)

Salva e chiudi il file.

=>3: Configurare Suricata
Assicurati che Suricata sia configurato per utilizzare il file di regole personalizzate. Apri il file di configurazione di Suricata (`suricata.yaml`):

nano /etc/suricata/suricata.yaml

Trova la sezione che riguarda le regole (`rule-files`) e aggiungi il tuo file di regole personalizzate:

rule-files:
  - local.rules

=>4: Eseguire Suricata sul File PCAP
Ora puoi eseguire Suricata per analizzare il file `dump.pcap.gz`. Puoi usare il seguente comando:

suricata -r dump.pcap.gz -l /path/to/output/directory

-> ad esempio: 
	partiamo col decomprimere il file PCAP (se e compresso come file .gz)
	gunzip ~/Downloads/dump.pcap.gz

	Poi per eseguire Suricata sul file PCAP decompresso:
	sudo suricata -r ~/Downloads/dump.pcap -l /var/log/suricata


=>5: Verificare i Risultati
Dopo che Suricata ha analizzato il file PCAP, puoi controllare i risultati nei file di log che si trovano nella directory di output specificata. Tipicamente, i log rilevanti si trovano nel file `eve.json`.

Per esempio, puoi usare il seguente comando per visualizzare il contenuto di `eve.json`:

cat /path/to/output/directory/eve.json | jq .

=>6: Analizzare i Log
Cerca le tue regole personalizzate nel file `eve.json`. Le voci corrispondenti alle tue regole avranno i messaggi `msg` che hai specificato ("Attacco" e "Risposta").

NB: Ecco un esempio completo di come eseguire Suricata con le regole personalizzate e analizzare un file PCAP compresso:
suricata -r dump.pcap.gz -l /var/log/suricata






PER OTTENERE LE PRIME 10 RIGHE DEL FILE EVE.JSON -----------------------------
Per vedere le prime 10 righe del file `eve.json`, puoi utilizzare diversi strumenti da riga di comando come `head`, `jq`, o anche combinazioni di comandi. Qui ci sono alcuni metodi che puoi usare:

=>Metodo 1: Usare `head`
head -n 10 /path/to/output/directory/eve.json

=>Metodo 2: Usare `jq`
Se vuoi formattare il JSON per renderlo più leggibile, puoi usare `jq`, un processore JSON da riga di comando.
jq . /path/to/output/directory/eve.json | head -n 10


=>Metodo 3: Usare `less` con ricerca e `jq`
jq . /path/to/output/directory/eve.json | less
Dentro `less`, puoi premere `G` per andare alla fine del file, `1G` per tornare all'inizio, e `q` per uscire.

=>Metodo 4: Usare `cat` e `head`
cat /path/to/output/directory/eve.json | head -n 10
```

-> per esempio:
	Supponiamo che il tuo file `eve.json` sia nella directory `/var/log/suricata`.
	-> Usando `head`:
	head -n 10 /var/log/suricata/eve.json
	->Usando `jq` per una formattazione migliore:
	jq . /var/log/suricata/eve.json | head -n 10







