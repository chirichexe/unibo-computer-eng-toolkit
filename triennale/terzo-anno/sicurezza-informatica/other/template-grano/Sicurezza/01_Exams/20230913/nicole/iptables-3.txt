**REGOLE INSTALLATE PER OGNI HOST**

iptables -F INPUT
iptables -F OUTPUT
iptables -F FORWARD

iptables -I INPUT -i lo -j ACCEPT
iptables -I OUTPUT -o lo -j ACCEPT

iptables -P INPUT DROP
iptables -P OUTPUT DROP
iptables -P FORWARD DROP

------------------

1. I Client sulla rete privata 192.168.0.0/24 devono poter interrogare DNS e servizi di sincronizzazione NTP in internet (porte UDP 53 e 1233)

**CLIENT**
iptables -A OUTPUT -s 192.168.0.0/24 -o eth1 -p udp --dport 53 -j ACCEPT (andata) 
iptables -A INPUT -i eth1 -d 192.168.0.0/24 -p udp --sport 53 -m state –state ESTABLISHED -j ACCEPT (ritorno)

iptables -A OUTPUT -s 192.168.0.0/24 -o eth1 -p udp --dport 1233 -j ACCEPT (andata) 
iptables -A INPUT -i eth1 -d 192.168.0.0/24 -p udp --sport 1233 -m state –state ESTABLISHED -j ACCEPT (ritorno)

**ROUTER**
iptables -A FORWARD -s 192.168.0.0/24 -p udp -i eth1 -o eth3 --dport 53 -j ACCEPT (andata) 
iptables -A FORWARD -d 192.168.0.0/24 -p udp -i eth3 -o eth1 --sport 53 -m state –state ESTABLISHED -j ACCEPT (ritorno)

iptables -A FORWARD -s 192.168.0.0/24 -p udp -i eth1 -o eth3 --dport 1233 -j ACCEPT (andata) 
iptables -A FORWARD -d 192.168.0.0/24 -p udp -i eth3 -o eth1 --sport 1233 -m state –state ESTABLISHED -j ACCEPT (ritorno)

se il NAT su R non è attivo devo applicare le seguenti regole (nella catena di POSTROUTING sto andando a dire che quello che proviene dal client (192.168.0.0/24) ed esce da eth3 deve essere SourseNat, e quindi deve essere cambiato l’indirizzo sorgente e sarà messo quello pubblico (130.136.5.15))
iptables -t nat -A POSTROUTING -s 192.168.0.0/24 -o eth3 -j SNAT --to-source 130.136.5.15

------------------

2. Il servizio SMTP (porta 25 tcp) del Server collocato sulla rete privata 172.16.0.0/20 deve essere raggiungibile da qualsiasi host di internet 

**SERVER**
iptables -A INPUT -d 172.16.0.0/20 -i eth1 -p tcp --sport 25 -j ACCEPT (andata) 
iptables -A OUTPUT -o eth1 -s 172.16.0.0/20 -p tcp --dport 25 -m state –state ESTABLISHED -j ACCEPT (ritorno)

**ROUTER**
iptables -A FORWARD -d 172.16.0.0/20 -p tcp -i eth3 -o eth2 --dport 25 -j ACCEPT (andata) 
iptables -A FORWARD -s 172.16.0.0/20 -p tcp -i eth2 -o eth3 --sport 25 -m state –state ESTABLISHED -j ACCEPT (ritorno)

iptables -t nat -A PREROUTING -p tcp -i eth3 -d 130.136.5.15 --dport 25 -j DNAT --to-destination 172.16.0.0/20 ??????

------------------

3. Il servizio LDAP (porta 389 tcp) del Router deve essere raggiungibile dal Server

**SERVER MIO**
iptables -A OUTPUT -s 172.16.0.0/20 -o eth1 -p tcp --sport 389 -j ACCEPT (andata) 
iptables -A INPUT -i eth1 -s 172.16.0.0/20 -p tcp --dport 389 -m state –state ESTABLISHED -j ACCEPT (ritorno)
**SERVER NICOLE**
iptables -A INPUT -p tcp -i eth1 -s 172.16.0.0/20 --sport 389 -j ACCEPT
iptables -A OUTPUT -p tcp -o eth1 -d 172.16.0.0/20 --dport 389 -m state --state ESTABLISHED -j ACCEPT

**ROUTER**
iptables -A FORWARD -s 172.16.0.0/20 -p tcp -i eth2 -o eth3 --dport 389 -j ACCEPT (andata: S->R) 
iptables -A FORWARD -d 172.16.0.0/20 -p tcp -i eth3 -o eth2 --sport 389 -m state –state ESTABLISHED -j ACCEPT (ritorno: R->S)



